DEFI WIND WINDADM1 FROM 03,00 TO 16,79 ;
                   TITLE " PACIENTES INGRESADOS " ;
                   FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,F5=OrdxCod,F6=Ord Alf,F7=OrdxCam,ESC=Selec/Salir ";
                   DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
DEFI WIND WINDADM2 FROM 17,00 TO 24,79 ;
                   TITLE " INFORMACION ADICIONAL " ;
                   DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND WINDADM1
ON KEY LABEL F1 DO PROCINC
ON KEY LABEL F2 DO PROCMOD
ON KEY LABEL F3 DO PROCELI
ON KEY LABEL F4 DO PROCBUS
ON KEY LABEL F5 DO PROCOXC
ON KEY LABEL F6 DO PROCOXA
ON KEY LABEL F7 DO PROCOXC
ON KEY LABEL F8
ON KEY LABEL F9
ON KEY LABEL F10
STORE 0         TO WRECADM
STORE SPACE(35) TO WNOMBRE
SELECT ADMADM
SET ORDER TO ADMADM2
BROWSE FIELDS CODPAC:H="CODIGO", TIPPAC:H="TIPO",UBICACION:H="UBICACION",CAMA:H="CAMA",;
              WNOMBRE=SUBSTR((ALLTRIM(PAPELLIDO)+" "+ALLTRIM(SAPELLIDO)+" "+ALLTRIM(PNOMBRE)+" "+ALLTRIM(SNOMBRE)),1,35):H="NOMBRE                              ",;
              WEDAD=STR(INT(    (DATE()-NACIMIENTO)/365      ),2):H="EDAD";
              NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDADM1 WHEN W2()
STORE CODPAC TO WCODPAC
STORE TIPPAC TO WTIPPAC
ON KEY LABEL F1
ON KEY LABEL F2
ON KEY LABEL F3
ON KEY LABEL F4
ON KEY LABEL F5
ON KEY LABEL F6
ON KEY LABEL F7
ON KEY LABEL F8
ON KEY LABEL F9
ON KEY LABEL F10
RELEASE WIND WINDADM1
RELEASE WIND WINDADM2
RETURN
***********
FUNCTION W2
***********
ACTI WIND WINDADM2
@ 00,00 SAY "Ingreso       : "+DTOC(INGRESO)
@ 01,00 SAY "Hora          : "+HORA
@ 02,00 SAY "Medico        : "+ALLTRIM(SYSMED.NOMBRE)+"  ("+ALLTRIM(SYSESP.DESCRI)+")                                   "
@ 03,00 SAY "Diagnostico   : "+DIAGNOS
@ 04,00 SAY "Cuenta        : "+CUENTA
@ 05,00 SAY "Refcia.Presup.: "+REFERE
ACTI WIND WINDADM1
RETURN
************
PROC PROCINC
************
PUSH KEY CLEAR
DEFI WIND WINDINC FROM 4,5 TO 16,79 TITLE " INCLUIR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10;
                  FOOTER " ENTER=Actualizar No-afiliados, ESC=Salir "
ACTI WIND WINDINC
DO WHILE .T.
   SELECT ADMADM
   SCAT MEMV BLANK
   @ 00,00 CLEAR
   @ 00,01 SAY "CODIGO PACIENTE :"
   @ 01,01 SAY "TIPO            :"
   @ 02,01 SAY "NOMBRE          :"
   @ 03,01 SAY "UBICACION       :"
   @ 04,01 SAY "FECHA INGRESO   :"
   @ 05,01 SAY "HORA  INGRESO   :"
   @ 06,01 SAY "CAMA            :"
   @ 07,01 SAY "ORDENADO POR    :"
   @ 08,01 SAY "DIAGNOSTICO     :"
   @ 09,01 SAY "REFCIA.PRESUP.  :"

   STORE SUBSTR(WCODPAC,1,10)      TO WCODPAC1
   STORE SUBSTR(WCODPAC,11,4)      TO WCODPAC2
   STORE VAL(WCODPAC2)             TO WCODPAC2
   @ 00,20 GET WCODPAC1 VALID VALCED()
   @ 00,30 SAY "-"
   @ 00,31 GET WCODPAC2 PICT "9999" VALID VALPAC()
   READ
   STORE STR(WCODPAC2,4)                     TO WCODPAC2
   STORE WCODPAC1+WCODPAC2                   TO WCODPAC
   STORE RTRIM(WCODPAC1)+"-"+LTRIM(WCODPAC2) TO WXCODPAC
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE WCODPAC TO M.CODPAC
   STORE WTIPPAC TO M.TIPPAC
   STORE ALLTRIM(M.PAPELLIDO)+" "+ALLTRIM(M.SAPELLIDO)+" "+ALLTRIM(M.PNOMBRE)+" "+ALLTRIM(M.SNOMBRE) TO WNOMBRE
   @ 01,20 SAY WTIPDES
   @ 02,20 SAY WNOMBRE
   SELECT ADMADM
   SET ORDER TO ADMADM2
   SEEK WCODPAC
   IF FOUND()
      STORE "YA INGRESADO, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      LOOP
   ELSE
      STORE WUSERUBI TO M.UBICACION
      STORE DATE()   TO M.INGRESO
      STORE TIME()   TO M.HORA
      @ 03,20 SAY M.UBICACION
      @ 04,20 SAY M.INGRESO
      @ 05,20 SAY M.HORA
      @ 06,20 GET M.CAMA   VALID VALCAM()
      READ
      @ 07,20 GET M.MEDICO VALID VALMED()
      READ
      @ 08,20 GET M.DIAGNOS
      READ
      STORE "NUMERO DEL PRESUPUESTO DE SERVICIOS, OPRIMA * PARA VER PRESUPUESTOS" TO WTEXT
      DO MENSAJE WITH WTEXT
      @ 09,20 GET M.REFERE
      READ
      *** INICIO RUTINA DE ACEPTAR-CANCELAR
      store 1 to wop
      do while .t.
         @ 10,25  get wop pict "@*H Aceptar;Cancelar" defa wop
         read
         if lastkey()=13
            exit
         endif
      enddo
      *** FIN  RUTINA ACEPTAR-CANCELAR
      if wop=1
         select admdata
         if filloc()
            replace cuenta with cuenta+1
            unlock all
            store cuenta to m.cuenta
            store ltrim(str(m.cuenta,7))                  to m.cuenta
            store replicate("0",7-len(m.cuenta))+m.cuenta to m.cuenta
            store "CTA"+m.cuenta                          to m.cuenta

            store wnacimiento                             to m.nacimiento
            select admadm
            if filloc()
               append blank
               gath memvar
               unlock all
            else
               store "OPERACION CANCELADA, REINTENTE" to wtext
               do aviso with wtext
            endif
         else
            store "OPERACION CANCELADA, REINTENTE" to wtext
            do aviso with wtext
         endif
      endif
   ENDIF
ENDDO
POP KEY
RELEASE WIND WINDINC
RETURN
***
************
PROC PROCMOD
************
PUSH KEY CLEAR
DEFI WIND WINDMOD FROM 4,5 TO 16,79 TITLE " MODIFICAR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDMOD
SELECT ADMADM
STORE RECNO() TO WRECADM
SCAT MEMV
@ 00,00 CLEAR
@ 00,01 SAY "CODIGO PACIENTE :"
@ 01,01 SAY "TIPO            :"
@ 02,01 SAY "NOMBRE          :"
@ 03,01 SAY "UBICACION       :"
@ 04,01 SAY "FECHA INGRESO   :"
@ 05,01 SAY "HORA  INGRESO   :"
@ 06,01 SAY "CAMA            :"
@ 07,01 SAY "ORDENADO POR    :"
@ 08,01 SAY "DIAGNOSTICO     :"
@ 09,01 SAY "REFCIA.PRESUP.  :"
@ 00,20 SAY M.CODPAC
STORE ALLTRIM(M.PAPELLIDO)+" "+ALLTRIM(M.SAPELLIDO)+" "+ALLTRIM(M.PNOMBRE)+" "+ALLTRIM(M.SNOMBRE) TO WNOMBRE
@ 01,20 SAY M.TIPPAC
@ 02,20 SAY WNOMBRE
@ 03,20 GET M.UBICACION
READ
@ 04,20 GET M.INGRESO
READ
@ 05,20 GET M.HORA
READ
@ 06,20 GET M.CAMA   VALID VALCAM()
READ
@ 07,20 GET M.MEDICO VALID VALMED()
READ
@ 08,20 GET M.DIAGNOS
READ
@ 09,20 GET M.REFERE
READ
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 10,25  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   select admadm
   go wrecadm
   if recloc()
      gath memvar
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
RELEASE WIND WINDMOD
POP KEY
RETURN
***
************
PROC PROCELI
************
PUSH KEY CLEAR
SELECT ADMHGEN
SEEK ADMADM.CODPAC
IF FOUND()
   STORE "NO SE PUEDE ELIMINAR PACIENTES CON ACTIVIDADES DE INGRESO HOSPITALARIO" TO WTEXT
   DO AVISO WITH WTEXT
   RETURN
ENDIF
DEFI WIND WINDELI FROM 4,5 TO 16,79 TITLE " ELIMINAR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDELI
SELECT ADMADM
SCAT MEMV
@ 00,00 CLEAR
@ 00,01 SAY "CODIGO PACIENTE :"
@ 01,01 SAY "TIPO            :"
@ 02,01 SAY "NOMBRE          :"
@ 03,01 SAY "UBICACION       :"
@ 04,01 SAY "FECHA INGRESO   :"
@ 05,01 SAY "HORA  INGRESO   :"
@ 06,01 SAY "CAMA            :"
@ 07,01 SAY "ORDENADO POR    :"
@ 08,01 SAY "DIAGNOSTICO     :"
@ 09,01 SAY "REFCIA.PRESUP.  :"
@ 00,20 SAY M.CODPAC
STORE ALLTRIM(M.PAPELLIDO)+" "+ALLTRIM(M.SAPELLIDO)+" "+ALLTRIM(M.PNOMBRE)+" "+ALLTRIM(M.SNOMBRE) TO WNOMBRE
@ 01,20 SAY M.TIPPAC
@ 02,20 SAY WNOMBRE
@ 03,20 SAY M.UBICACION
@ 04,20 SAY M.INGRESO
@ 05,20 SAY M.HORA
@ 06,20 SAY M.CAMA
@ 07,20 SAY M.MEDICO
@ 08,20 SAY M.DIAGNOS
@ 09,20 SAY M.REFERE
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 10,25  get wop pict "@*H Cancelar;Aceptar " defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=2
   select admadm
   if recloc()
      delete
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
POP KEY
RELEASE WIND WINDELI
RETURN
***
************
PROC PROCBUS
************
PUSH KEY CLEAR
DEFI WIND WPROCBC FROM 9,00 TO 11,79;
                  TITLE " BUSCAR "  ;
                  DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WPROCBC
DO WHILE .T.
   STORE SPACE(20) TO WBUS
   @ 00,01 SAY "CLAVE :"
   @ 00,09 GET WBUS
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   SELECT ADMADM
   SEEK ALLTRIM(WBUS)
   IF FOUND()
      EXIT
   ELSE
      STORE "NO REGISTRADO, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
   ENDIF
ENDDO
RELEASE WIND WPROCBC
POP KEY
RETURN
************
PROC PROCOXC
************
SET ORDER TO ADMADM2
RETURN
************
PROC PROCOXA
************
SET ORDER TO ADMADM5
RETURN
************
PROC PROCOXC
************
SET ORDER TO ADMADM4
RETURN
****************
PROCEDURE VALCED
****************
IF WCODPAC1<>SPACE(10)
   RETURN .T.
ELSE
   STORE 5 TO LIBRPAC
   STORE 0 TO CIBRPAC
   DO SYS0103
   STORE SUBSTR(CODPAC,1,10)      TO WCODPAC1
   STORE VAL(SUBSTR(CODPAC,11,4)) TO WCODPAC2
   STORE ALLTRIM(PAPELLIDO)+", "+ALLTRIM(PNOMBRE) TO WNOMBRE
   RETURN .T.
ENDIF
****************
PROCEDURE VALPAC
****************
STORE WCODPAC1+STR(WCODPAC2,4) TO WCODPAC
SELECT AFIAFI
SET ORDER TO AFIAFI1
SEEK WCODPAC
IF .NOT. FOUND()
   SELECT SYSPAC
   SET ORDER TO SYSPAC
   SEEK WCODPAC
   IF .NOT. FOUND()
      STORE 5 TO LIBRPAC
      STORE 0 TO CIBRPAC
      DO SYS0103
      STORE SUBSTR(CODPAC,1,10)      TO WCODPAC1
      STORE VAL(SUBSTR(CODPAC,11,4)) TO WCODPAC2
      STORE ALLTRIM(PAPELLIDO)+", "+ALLTRIM(PNOMBRE) TO WNOMBRE
      RETURN .F.
   ELSE
      STORE "N"                     TO WTIPPAC
      STORE "No afiliado"           TO WTIPDES
      STORE PAPELLIDO               TO M.PAPELLIDO
      STORE SAPELLIDO               TO M.SAPELLIDO
      STORE PNOMBRE                 TO M.PNOMBRE
     STORE SNOMBRE                 TO M.SNOMBRE
     STORE NACIMIENTO              TO WNACIMIENTO
     RETURN .T.
  ENDIF
ELSE
   STORE "A"                        TO WTIPPAC
   IF VAL(SUBSTR(WCODPAC,11,4))=0
      STORE "Afiliado-Titular   "   TO WTIPDES
   ELSE
      STORE "Afiliado-Carga Fam."   TO WTIPDES
   ENDIF
   STORE PAPELLIDO                  TO M.PAPELLIDO
   STORE SAPELLIDO                  TO M.SAPELLIDO
   STORE PNOMBRE                    TO M.PNOMBRE
   STORE SNOMBRE                    TO M.SNOMBRE
   STORE NACIMIENTO                 TO WNACIMIENTO
   RETURN .T.
ENDIF
RETURN .T.
***********
FUNC VALCAM
***********
DO WHILE .T.
   SELECT SYSCAMA
   SEEK M.CAMA
   IF FOUND()
      STORE .F. TO WFLAGOCU
      SELECT ADMADM
      SET ORDER TO ADMADM2
      GO TOP
      DO WHILE .NOT. EOF()
         IF M.CAMA=CAMA.AND.M.CODPAC<>CODPAC
            STORE "CAMA OCUPADA, VERIFIQUE" TO WTEXT
            DO AVISO WITH WTEXT
            STORE .T. TO WFLAGOCU
            STORE SPACE(5) TO M.CAMA
            EXIT
         ENDIF
         SKIP
      ENDDO
      IF WFLAGOCU
         RETURN .F.
      ELSE
         SELECT SYSCAMA
         @ 06,26 SAY DESCRI
         RETURN .T.
      ENDIF
   ELSE
      STORE 12 TO LIBRCAM
      STORE 10 TO CIBRCAM
      DO ADMWINCA
      RELE WIND BRCAM
      STORE CAMA TO M.CAMA
   ENDIF
ENDDO
RETURN .T.
***********
FUNC VALMED
***********
SELECT SYSMED
DO WHILE .T.
   SEEK M.MEDICO
   IF FOUND()
      @ 07,25 SAY NOMBRE
      RETURN .T.
   ELSE
      STORE 13 TO LIBRMED
      STORE 10 TO CIBRMED
      DO ADMWINMD
      RELE WIND BRMED
      STORE MEDICO TO M.MEDICO
   ENDIF
ENDDO
RETURN .T.
***********
PROC VALREF
***********
PUSH KEY CLEAR
DEFI WIND WINDGE FROM 1,0 TO 09,79;
          TITLE  " PRESUPUESTOS " ;
          FOOTER " F1=Inc, F2=Mod, F3=Eli, F4=Bus, F5=Precios, F6=Ver, Esc=Salir " ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDGE
SELECT FACPREGE
BROWSE FIELDS NUMERO,NOMTRA1:H="DESCRIPCION DEL PRESUPUESTO",CODCLI:H="CLIENTE";
       NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDGE
DEACT WIND WINDGE
STORE NUMERO TO M.REFERE
POP KEY
RETURN
******

