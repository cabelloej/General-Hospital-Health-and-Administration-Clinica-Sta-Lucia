STORE "OPCIONES: (I)NCLUIR, (A)CTUALIZAR, (S)ALIR" TO TEX
STORE "SIA" TO WCH
DO PREGUNTA
IF WCH="S"
   RETURN
ENDIF
STORE WCH TO WACCION
IF WCH="I"
   SELECT COMDATA
   IF RECLOC()
      REPLACE COMSERIREC WITH COMSERIREC+1
      STORE COMSERIREC   TO   WNUMNUM
      FLUSH
      UNLOCK ALL
   ENDIF
ELSE
   STORE 0 TO WNUMNUM
ENDIF

STORE 0              TO WNUMERO
STORE "REC"          TO WTIPODOC
STORE "RECEPCION "   TO WDOCDES1
STORE "   DE     "   TO WDOCDES2
STORE " COMPRAS  "   TO WDOCDES3
STORE SPACE(10)      TO WNUMERO2
STORE SPACE(12)      TO WPROVEEDOR
STORE DATE()         TO WELABORADO
STORE 0              TO WMONTODOC
STORE 0              TO WMONTO
STORE .F.            TO WFLAGELA
DO COMELADC
IF .NOT. WFLAGELA
   RETURN
ELSE
   SELECT COMDCGE
   STORE RECNO() TO WREGREC
   SEEK COMDCGE->REFERENCIA
   IF FOUND()
      STORE MONTO   TO WQMONREF
      STORE RECNO() TO WREGREF
   ELSE
      STORE 0     TO WQMONREF
      STORE 0     TO WREGREF
   ENDIF
   IF WQMONREF<>0
      IF WMONTO<WQMONREF
         STORE "ORDEN RECIBIDA PARCIALMENTE,(Bs."+STR(WQMONREF,10,2)+" GRABARLA COMO RECIBIDA ? (S/N)" TO TEX
         STORE "SN" TO WCH
         DO PREGUNTA
         IF WCH = "S"
            STORE "S"      TO WRECIBIDA
         ELSE
           STORE SPACE(1)  TO WRECIBIDA
         ENDIF
      ELSE
         STORE "S"         TO WRECIBIDA
      ENDIF
   ELSE
      STORE SPACE(1)       TO WRECIBIDA
   ENDIF
ENDIF
SELECT COMDCGE
IF FILLOC()
   REPLACE RECIBIDA WITH WRECIBIDA
   UNLOCK ALL
ELSE
   STORE "OPERACION ABORTADA, REINTENTE" TO MES
   DO AVISO WITH MES
ENDIF

GO WREGREC
STORE "DESEA IMPRIMIR LA RECEPCION ? (S/N)" TO TEX
STORE "SN" TO WCH
DO PREGUNTA
IF WCH = "S"
   DO WHILE .T.
      DO COMIMPDC
      STORE "CONFORME CON IMPRESION ? (S/N)" TO TEX
      STORE "SN" TO WCH
      DO PREGUNTA
      IF WCH="S"
         EXIT
      ENDIF
   ENDDO
ENDIF
RETURN
