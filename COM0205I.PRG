SAVE SCRE TO SCRCXP
@ 5,0
STORE .T. TO WACT
DO WHILE WACT
   SELECT COMDATA
   IF RECLOC()
      REPLACE COMSERICXP WITH COMSERICXP+1
      UNLOCK ALL
      FLUSH
   ELSE
      RETURN
   ENDIF
   STORE LTRIM(STR(COMSERICXP,7))              TO WCODCXP
   STORE REPLICATE("0",7-LEN(WCODCXP))+WCODCXP TO WCODCXP
   SELECT COMCXP
   STORE SPACE(LEN(BENEFI))     TO WBENEFI
   STORE SPACE(LEN(REFERENCIA)) TO WREFERENCIA
   STORE SPACE(LEN(REFERPROVE)) TO WREFERPROVE
   STORE CTOD("  -  -  ")       TO WELABORADO
   STORE 0                      TO WSUBDOC
   STORE 0                      TO WPORIMP
   STORE 0                      TO WSUBIMP
   STORE 0                      TO WTOTDOC
   STORE CTOD("  -  -  ")       TO WVENCE
   STORE CTOD("  -  -  ")       TO WCANCELADO
   STORE SPACE(30)              TO WBENEFIDES
   
   @ 07,01 CLEAR TO 18,78
   @ 20,0
   @ 21,0 
   @ 07,27 SAY "INCLUIR CUENTA POR PAGAR" 
   @ 08,01 SAY "CUENTA POR PAGAR No.: "
   @ 08,25 SAY  WCODCXP
   @ 09,01 SAY "BENEFICIARIO        : " GET WBENEFI         VALID VALBENE()
   @ 10,01 SAY "REFERENCIA INTERNA  : " GET WREFERENCIA     VALID VALREFINT()
   @ 11,01 SAY "REFERENCIA PROVEED. : " GET WREFERPROVE     VALID VALREFPRO()
   @ 12,01 SAY "FECHA DE ELABORACION: " GET WELABORADO
   @ 13,01 SAY "SUBTOTAL DOCUMENTO  : " GET WSUBDOC PICTURE "999,999,999.99" VALID VALSUBDOC()
   @ 14,01 SAY "% DE IMPUESTOS      : " GET WPORIMP PICTURE "99.99"          VALID VALPORIMP()
   @ 15,01 SAY "SUBTOTAL IMPUESTOS  : "
   @ 16,01 SAY "TOTAL DOCUMENTO     : "
   @ 17,01 SAY "FECHA DE VENCIMIENTO: " GET WVENCE          VALID VALVEN()
   READ
   IF LASTKEY()=27
      STORE .F. TO WACT
      GO TOP
      STORE RECNO() TO WINICIO
      STORE .T. TO FLAGJUMP
      STORE 0 TO WREVERSE
      LOOP
   ENDIF
   STORE "CXP"+WCODCXP TO WCLAVE
   SELECT COMCXP
   FIND &WCLAVE
   IF .NOT. EOF()
      STORE "CODIGO YA EXISTE EN EL FICHERO. <ENTER>" TO MES
      DO AVISO WITH MES
      LOOP
   ENDIF
   STORE "CONFORME ? (S/N)" TO TEX
   STORE "SN" TO WCH
   DO PREGUNTA
   IF WCH = "N"
      LOOP
   ENDIF
   SELECT COMCXP
   IF FILLOC()
      APPEND BLANK
      REPLACE CODCXP         WITH WCODCXP
      REPLACE BENEFI         WITH WBENEFI
      REPLACE REFERENCIA     WITH WREFERENCIA
      REPLACE REFERPROVE     WITH WREFERPROVE
      REPLACE ELABORADO      WITH WELABORADO
      REPLACE SUBDOC         WITH WSUBDOC
      REPLACE PORIMP         WITH WPORIMP
      REPLACE SUBIMP         WITH WSUBIMP
      REPLACE TOTDOC         WITH WTOTDOC
      REPLACE VENCE          WITH WVENCE
      REPLACE CANCELADO      WITH WCANCELADO
      REPLACE ORIGEN         WITH "CXP"
      REPLACE DEPTO          WITH WUSERUBI
      REPLACE USUARIO        WITH WUSERCODE
      REPLACE USUARIOF       WITH DATE()
      UNLOCK ALL
      FLUSH
   ENDIF
ENDDO
RESTORE SCRE FROM SCRCXP
RETURN
**************
FUNC VALBENE
DO WHILE .T.
   SELECT COMPRO
   SEEK WBENEFI
   IF FOUND()
      STORE DESCRI TO WBENEFIDES
      @ 09,45 SAY  WBENEFIDES
      SELECT COMCXP
      RETURN .T.
   ELSE
      STORE "CODIGO DE PROVEEDOR NO REGISTRADO, FAVOR INGRESAR" TO MES
      DO AVISO WITH MES
      SELECT COMCXP
      RETURN .F.
      *SAVE SCRE TO WSCREPRO
      *DO BC0108  *** NO AUTORIZADO, SOLO BANCOS
      *IF .NOT. EOF()
      *   STORE CODIGO TO WBENEFI
      *ELSE
      *   STORE "?"    TO WBENEFI
      *ENDIF
      *RESTORE SCRE FROM WSCREPRO
   ENDIF
ENDDO
RESTORE SCRE FROM SCRCXP
**************
FUNC VALREFINT
IF WREFERENCIA=SPACE(10)
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
**************
*DO WHILE .T.
*   IF WREFERENCIA=SPACE(10)
*      RETURN .F.
*   ELSE
*      IF SUBSTR(WREFERENCIA,1,3)<>"REC"
*         STORE "LA REFERENCIA DEBE SER UNA RECEPCION DE COMPRA, EJEMPLO: REC1234567" TO MES
*         DO AVISO WITH MES
*         RETURN .F.
*      ENDIF
*      SELECT COMDCGE
*      SET ORDER TO COMDCGE2
*      SEEK WREFERENCIA
*      IF FOUND()
*         RETURN .T.
*      ELSE
*         STORE "REFERENCIA NO REGISTRADA, VERIFIQUE" TO MES
*         DO AVISO WITH MES
*         RETURN .F.
*      ENDIF
*      SET ORDER TO COMDCGE
*   ENDIF
*ENDDO
**************
FUNC VALREFPRO
IF WREFERPROVE=SPACE(10)
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
**************
FUNC VALSUBDOC
IF WSUBDOC>0
   RETURN .T.
ELSE
   RETURN .F.
ENDIF
**************
FUNC VALPORIMP
IF WPORIMP<0
   RETURN .F.
ELSE
   STORE (WSUBDOC*WPORIMP)/100  TO WSUBIMP
   @ 15,25 SAY  WSUBIMP     PICTURE "999,999,999.99"
   STORE (WSUBDOC+WSUBIMP) TO WTOTDOC
   @ 16,25 SAY  WTOTDOC PICTURE "999,999,999.99"
   RETURN .T.
ENDIF
***********
FUNC VALVEN
IF WVENCE<WELABORADO
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
