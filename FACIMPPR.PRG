SELECT FACPREGE
SEEK WNUMERO
IF .NOT. FOUND()
   STORE "NUMERO DE PRESUPUESTO NO REGISTRADO, VERIFIQUE" TO WTEXT
   DO AVISO
   RETURN
ENDIF
STORE 0   TO WPAGINA
STORE 0   TO WTOTREN
STORE 0   TO WTOTPRE
STORE 100 TO WLINEA
IF WSALIDA = 1
   DEFI WIND WINDSAL FROM 0,0 TO 25,81;
          NONE NOFLOAT NOZOOM NOGROW NOSHADOW COLOR SCHEME 10
   ACTI WIND WINDSAL
   STORE 21 TO WSALTO
ELSE
   SET DEVI TO PRINT
   STORE 60 TO WSALTO
ENDIF

SELECT FACPREDE
SEEK WNUMERO
STORE "**" TO WRUPTIP
STORE "**" TO WRUPESP
STORE "**" TO WRUPGRU
STORE .T.  TO WFLAGMED
DO WHILE .NOT.EOF().AND.NUMERO=WNUMERO
   STORE SUBSTR(ITEM,1,2) TO WTIP
   STORE SUBSTR(ITEM,1,5) TO WESP
   STORE SUBSTR(ITEM,1,8) TO WGRU
   DO RUPTURA
   ***
   IF FACPREDE.TIPITEM="B"
      SELECT ALMART
      SEEK FACPREDE.ITEM
   ELSE
      SELECT SYSSERVI
      SEEK ALLTRIM(FACPREDE.ITEM)
   ENDIF
   IF FOUND()
      STORE  DESCRI TO WNOMITEM
   ELSE
      STORE FACPREDE.ITEM+" NO REG." TO WNOMITEM
   ENDIF
   STORE WLINEA+1 TO WLINEA
   DO VERSALTO
   SELECT FACPREDE
   IF WSALIDA=1
      @ WLINEA,00 SAY SUBSTR(WNOMITEM,1,40)
   ELSE
      @ WLINEA,00 SAY CHR(18)+CHR(15)+WNOMITEM+CHR(18)
   ENDIF
   @ WLINEA,41 SAY CANTIDAD   PICTURE "9999.99"
   @ WLINEA,49 SAY PRECIO     PICTURE "9999999.99"
   @ WLINEA,60 SAY DESCUENTO  PICTURE "99.99"
   STORE CANTIDAD*(PRECIO-(PRECIO*DESCUENTO/100)) TO WTOTREN
   @ WLINEA,66 SAY WTOTREN    PICTURE "99,999,999.99"
   STORE WTOTPRE+WTOTREN TO WTOTPRE
   SELECT FACPREDE
   SKIP
ENDDO
STORE WLINEA+1 TO WLINEA
DO VERSALTO
@ WLINEA,00 SAY REPLICATE(".",79)
STORE WLINEA+1 TO WLINEA
DO VERSALTO
@ WLINEA,40 SAY "TOTAL PRESUPUESTO :"
@ WLINEA,40 SAY "TOTAL PRESUPUESTO :"
@ WLINEA,66 SAY WTOTPRE PICTURE "99,999,999.99"

IF WSALIDA=1
   STORE "OPRIMA ENTER PARA FINALIZAR" TO WTEXT
   DO AVISO WITH WTEXT
   RELE WIND WINDSAL
ELSE
   EJECT
   SET DEVI TO SCRE
ENDIF
RETURN
************************************************************************
*************
PROC VERSALTO
*************
IF WLINEA>WSALTO
   IF WSALIDA=1.AND.WPAGINA>0
      STORE "OPRIMA ENTER PARA CONTINUAR" TO WTEXT
      DO AVISO WITH WTEXT
   ENDIF
   DO HEADING
ENDIF
RETURN
*************
PROC HEADING
************
STORE WPAGINA+1 TO WPAGINA
IF WSALIDA = 1
   @ 00,00 CLEAR
   @ 00,00 SAY QQWW
ELSE
   @ 00,00 SAY CHR(14)+QQWW
   @ 00,00 SAY CHR(14)+QQWW
ENDIF
@ 02,55 SAY "Presupuesto :"
@ 02,55 SAY "Presupuesto :"+FACPREGE.NUMERO
@ 03,55 SAY "Fecha       :"
@ 03,55 SAY "Fecha       :"+DTOC(FACPREGE.FECHA)
@ 04,55 SAY "Pagina      :"
@ 04,55 SAY "Pagina      :"+ALLTRIM(STR(WPAGINA,3))
@ 05,00 SAY "Descripcion:"
@ 05,00 SAY "Descripcion:"+FACPREGE.NOMTRA1
@ 06,00 SAY "            "+FACPREGE.NOMTRA2
IF SUBSTR(FACPREGE.CODCLI,1,1)="*"
   STORE FACPREGE.NOMCLI          TO WNOMCLI
ELSE
   SELECT FACCLI
   SEEK FACPREGE.CODCLI
   IF FOUND()
      STORE DESCLI     TO WNOMCLI
   ELSE                      
      STORE SPACE(10)  TO WNOMCLI
   ENDIF
ENDIF
@ 07,00 SAY "Cliente    :"
@ 07,00 SAY "Cliente    :"+ALLTRIM(FACPREGE.CODCLI)+" "+WNOMCLI
@ 09,00 SAY replicate("-",79)
@ 09,00 SAY replicate("-",79)
@ 10,00 say "Descripcion"
@ 10,00 say "Descripcion"
@ 10,41 say " Cantd."
@ 10,41 say " Cantd."
@ 10,49 say "    Precio"
@ 10,49 say "    Precio"
@ 10,60 say "%Desc."
@ 10,60 say "%Desc."
@ 10,66 say "  Total Reng."
@ 10,66 say "  Total Reng."
@ 11,00 SAY replicate("-",79)
@ 11,00 SAY replicate("-",79)
STORE 12 TO WLINEA
RETURN
************
PROC RUPTURA
************
IF WTIP<>WRUPTIP.OR.WESP<>WRUPESP.OR.WGRU<>WRUPGRU
   IF FACPREDE.TIPITEM="S"
      SELECT SYSSERVI
      IF WTIP<>WRUPTIP
         SEEK WTIP+"-  -  -   "
         IF FOUND()
            STORE  DESCRI     TO WNOMTIP
         ELSE
            STORE SPACE(1)    TO WNOMTIP
         ENDIF
         STORE WLINEA+1 TO WLINEA
         DO VERSALTO
         @ WLINEA,40-LEN(ALLTRIM(WNOMTIP))/2 SAY ALLTRIM(WNOMTIP)
         @ WLINEA,40-LEN(ALLTRIM(WNOMTIP))/2 SAY ALLTRIM(WNOMTIP)
         *STORE WLINEA+1 TO WLINEA
         *DO VERSALTO
         *@ WLINEA,40-LEN(ALLTRIM(WNOMTIP))/2 SAY REPLICATE("-",LEN(ALLTRIM(WNOMTIP)))
         STORE WTIP TO WRUPTIP
      ENDIF
      IF WESP<>WRUPESP
         SEEK WESP+"-  -   "
         IF FOUND()
            STORE  ". "+DESCRI TO WNOMESP
         ELSE
            STORE SPACE(1)    TO WNOMESP
         ENDIF
         STORE WLINEA+1 TO WLINEA
         DO VERSALTO
         @ WLINEA,00 SAY WNOMESP
         STORE WESP TO WRUPESP
      ENDIF
      IF WGRU<>WRUPGRU
         SEEK WGRU+"-   "
         IF FOUND()
            STORE  "._ "+DESCRI TO WNOMGRU
         ELSE
            STORE SPACE(1)    TO WNOMGRU
         ENDIF
         STORE WLINEA+1 TO WLINEA
         DO VERSALTO
         @ WLINEA,00 SAY WNOMGRU
         STORE WGRU TO WRUPGRU
      ENDIF
   ELSE
      IF WFLAGMED
         STORE WLINEA+1 TO WLINEA
         DO VERSALTO
         @ WLINEA,20 SAY  "MEDICAMENTOS y MATERIAL MEDICO-QUIRURJICO"
         @ WLINEA,20 SAY  "MEDICAMENTOS y MATERIAL MEDICO-QUIRURJICO"
         *STORE WLINEA+1 TO WLINEA
         *DO VERSALTO
         *@ WLINEA,20 SAY  "-----------------------------------------"
         STORE .F. TO WFLAGMED
      ENDIF
   ENDIF
ENDIF
RETURN
******
