DEFI WIND WINDI FROM 2,0 TO 21,79 TITLE " INCLUIR ";
          DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND WINDI
***
STORE .T. TO WACT
DO WHILE WACT
   ***
   SELECT FACCXC
   STORE SPACE(LEN(CODCLI))       TO WCODCLI
   STORE SPACE(LEN(REFERENCIA))   TO WREFERENCIA
   STORE SPACE(LEN(REFERCLI))     TO WREFERCLI
   STORE DATE()                   TO WELABORADO
   STORE 0                        TO WSUBDOC
   STORE 0                        TO WPORIMP
   STORE 0                        TO WSUBIMP
   STORE 0                        TO WTOTDOC
   STORE DATE()+FACDATA.DIASCREDI TO WVENCE
   STORE CTOD("  -  -  ")         TO WCANCELADO
   STORE SPACE(30)                TO WCLIDES
   ***
   @ 01,01 SAY "CUENTA X COBRAR  No.:  "+WUSERCODE
   @ 02,01 SAY "DEUDOR              : " GET WCODCLI         VALID VALCLI()
   @ 03,01 SAY "REFERENCIA INTERNA  : " GET WREFERENCIA     VALID VALREFINT()
   @ 04,01 SAY "REFERENCIA PROVEED. : " GET WREFERCLI       VALID VALREFCLI()
   @ 05,01 SAY "FECHA DE ELABORACION: " GET WELABORADO
   @ 06,01 SAY "SUBTOTAL DOCUMENTO  : " GET WSUBDOC PICTURE "999,999,999.99" VALID VALSUBDOC()
   @ 07,01 SAY "% DE IMPUESTOS      : " GET WPORIMP PICTURE "99.99"          VALID VALPORIMP()
   @ 08,01 SAY "SUBTOTAL IMPUESTOS  : "
   @ 09,01 SAY "TOTAL DOCUMENTO     : "
   @ 10,01 SAY "FECHA DE VENCIMIENTO: " GET WVENCE          VALID VALVEN()
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE "CONFORME ? (S/N)" TO TEX
   STORE "SN" TO WCH
   DO PREGUNTA
   IF WCH = "N"
      EXIT
   ENDIF
   ***
   SELECT FACDATA
   IF RECLOC()
      REPLACE FACSERICXC WITH FACSERICXC+1
      UNLOCK ALL
      FLUSH
   ELSE
      EXIT
   ENDIF
   STORE LTRIM(STR(FACSERICXC,7))              TO WCODCXC
   STORE REPLICATE("0",7-LEN(WCODCXC))+WCODCXC TO WCODCXC
   STORE "CXC"+WCODCXC TO WCLAVE
   SELECT FACCXC
   SEEK WCLAVE
   IF .NOT. EOF()
      STORE "CODIGO YA EXISTE EN CXC" TO MES
      DO AVISO WITH MES
      EXIT
   ENDIF
   ***
   SELECT FACCXC
   IF FILLOC()
      APPEND BLANK
      REPLACE CODCXC         WITH WCODCXC
      REPLACE CODCLI         WITH WCODCLI
      REPLACE REFERENCIA     WITH WREFERENCIA
      REPLACE REFERCLI       WITH WREFERCLI
      REPLACE ELABORADO      WITH WELABORADO
      REPLACE SUBDOC         WITH WSUBDOC
      REPLACE PORIMP         WITH WPORIMP
      REPLACE SUBIMP         WITH WSUBIMP
      REPLACE TOTDOC         WITH WTOTDOC
      REPLACE VENCE          WITH WVENCE
      REPLACE CANCELADO      WITH WCANCELADO
      REPLACE ORIGEN         WITH "CXC"
      REPLACE DEPTO          WITH WUSERUBI
      REPLACE USUARIO        WITH WUSERCODE
      REPLACE USUARIOF       WITH DATE()
      UNLOCK ALL
      FLUSH
   ENDIF
   EXIT
ENDDO
DEACT WIND WINDI
***********
FUNC VALCLI
***********
DO WHILE .T.
   SELECT FACCLI
   SEEK WCODCLI
   IF FOUND()
      STORE DESCLI TO WNOMCLI
      @ 02,45 SAY  WNOMCLI
      RETURN .T.
   ELSE
      STORE "CODIGO DE DEUDOR NO REGISTRADO, FAVOR INGRESAR" TO MES
      DO AVISO WITH MES
      DO FAC0102
      STORE CODCLI TO WCODCLI
      STORE DESCLI TO WNOMCLI
      @ 02,45 SAY  WNOMCLI
      RETURN .T.     
   ENDIF
ENDDO
**************
FUNC VALREFINT
IF WREFERENCIA=SPACE(10)
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
**************
FUNC VALREFCLI
IF WREFERCLI=SPACE(10)
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
**************
FUNC VALSUBDOC
IF WSUBDOC>0
   RETURN .T.
ELSE
   RETURN .F.
ENDIF
**************
FUNC VALPORIMP
IF WPORIMP<0
   RETURN .F.
ELSE
   STORE (WSUBDOC*WPORIMP)/100  TO WSUBIMP
   @ 08,24 SAY  WSUBIMP     PICTURE "999,999,999.99"
   STORE (WSUBDOC+WSUBIMP) TO WTOTDOC
   @ 09,24 SAY  WTOTDOC PICTURE "999,999,999.99"
   RETURN .T.
ENDIF
***********
FUNC VALVEN
IF WVENCE<WELABORADO
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
