*** REVERSA OPERACION
SELECT FACCXC
SET ORDER TO FACCXC3
DO WHILE .T.
   SEEK FACDCGE.NUMERO
   IF FOUND()
      IF FILLOC()
         STORE CODCXC TO WCODDEL
         DELETE
         UNLOCK ALL
         *
         SELECT FACCXCTR
         SET ORDER TO FACCXCT1
         DO WHILE .T.
            SEEK WCODDEL
            IF FOUND()
               IF FILLOC()
                  DELETE
                  UNLOCK ALL
               ENDIF
            ELSE
               EXIT
            ENDIF
         ENDDO
         *
      ELSE
         STORE "OPERACION RECHAZADA, FAVOR REINTENTAR" TO MES
         DO AVISO WITH MES
         RETURN
      ENDIF
   ELSE
      EXIT
   ENDIF
ENDDO
*** VERIFICA FORMA DE PAGO
IF FACDCGE.PAGOFOR="C" .OR. FACDCGE.MONTO=0
   RETURN
ENDIF
***
SELECT FACCXC
SET ORDER TO FACCXC3
SEEK FACDCGE.NUMERO
SET ORDER TO FACCXC1
IF .NOT. FOUND()
   IF FILLOC()
      SELECT FACDATA
      IF RECLOC()
         REPLACE FACSERICXC WITH FACSERICXC+1
         STORE FACSERICXC TO WCODCXC
         FLUSH
         UNLOCK ALL
         STORE LTRIM(STR(WCODCXC,7))                 TO WCODCXC
         STORE REPLICATE("0",7-LEN(WCODCXC))+WCODCXC TO WCODCXC
      ELSE
         STORE "OPERACION ABORTADA, REINTENTE" TO MES
         DO AVISO WITH MES
         SELECT FACCXC
         UNLOCK ALL
         RETURN
      ENDIF
      SELECT FACCXC
      APPEND BLANK
      REPLACE CODCXC WITH WCODCXC
      FLUSH
      UNLOCK ALL
   ELSE
      STORE "OPERACION ABORTADA, REINTENTE" TO MES
      DO AVISO WITH MES
      SELECT FACCXC
      UNLOCK ALL
      RETURN
   ENDIF
ENDIF
IF RECLOC()
   REPLACE REFERENCIA WITH FACDCGE->NUMERO
   REPLACE CODCLI     WITH FACDCGE->CODCLI
   REPLACE ELABORADO  WITH FACDCGE->ELABORADO
   REPLACE VENCE      WITH FACDCGE->VENCE
   REPLACE CANCELADO  WITH CTOD("  -  -    ")
   REPLACE SUBDOC     WITH FACDCGE->SUBDOC
   REPLACE PORIMP     WITH FACDCGE->PORIMP
   REPLACE SUBIMP     WITH FACDCGE->SUBIMP
   REPLACE TOTDOC     WITH FACDCGE->MONTO
   REPLACE ORIGEN     WITH "FAC"
   REPLACE DEPTO      WITH WUSERUBI
   REPLACE USUARIO    WITH WUSERCODE
   REPLACE USUARIOF   WITH DATE()
   FLUSH
   UNLOCK ALL
ELSE
   STORE "OPERACION ABORTADA, REINTENTE" TO MES
   DO AVISO WITH MES
ENDIF
RETURN

