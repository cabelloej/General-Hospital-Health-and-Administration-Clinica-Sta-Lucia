SELECT SYSMED
DEFI WIND BRMED FROM LIBRMED,CIBRMED TO LIBRMED+10,CIBRMED+79;
                TITLE " PERSONAL CLINICO " ;
                FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,F6=Lis,ESC=Sel ";
                DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND BRMED
ON KEY LABEL F1 DO BRINC
ON KEY LABEL F2 DO BRMOD
ON KEY LABEL F3 DO BRELI
ON KEY LABEL F4 DO BRBUS
ON KEY LABEL F6 DO SYS0107R
BROWSE FIELDS MEDICO:H="CODIGO", NOMBRE:H="NOMBRE",SYSESP.DESCRI:H="ESPECIALIDAD",;
              COLEGIO:H="No.COLEGIO", MSAS:H="No.M.S.A.S.";
              NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW BRMED
RELEASE WIND BRMED
RETURN
***********************
***                 ***
***RUTINAS DE BRMED ***
***                 ***
***********************
***************
PROCEDURE BRINC
IF WACCESO<>"A"
   RETURN
ENDIF
DEFI WIND WINCMED FROM LIBRMED+4,CIBRMED+10 TO LIBRMED+17,CIBRMED+75;
                  TITLE " INCLUIR PERSONAL " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCMED
DO WHILE .T.
   SCAT MEMV BLANK
   @ 00,00 CLEAR
   @ 00,01 SAY "CODIGO      :"
   @ 01,01 SAY "NOMBRE      :"
   @ 02,01 SAY "ESPECIALIDAD:"
   @ 03,01 SAY "No.COLEGIO  :"
   @ 04,01 SAY "No.M.S.A.S. :"
   @ 05,01 SAY "USUARIO     :"
   @ 06,01 SAY "CEDULA      :"
   @ 07,01 SAY "DIRECCION   :"
   @ 08,01 SAY "TELEFONO    :"
   @ 09,01 SAY "I.S.L.R.    :"
   @ 10,01 say "AREA DE SERV:"
   @ 00,15 GET M.MEDICO
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF LEN(ALLTRIM(M.MEDICO))=0
      LOOP
   ENDIF
   SEEK M.MEDICO
   IF FOUND()
      @ 01,15 SAY NOMBRE
      STORE "YA EXISTE, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      LOOP
   ELSE
      @ 01,15 GET M.NOMBRE
      @ 02,15 GET M.ESPECI    VALID VALESP()
      @ 03,15 GET M.COLEGIO   
      *VALID VALCOL()
      @ 04,15 GET M.MSAS      
      *VALID VALSAS()
      @ 05,15 GET M.USERCODE  
      *VALID VALUSE()
      @ 06,15 GET M.CEDULA    
      *VALID VALCED()
      @ 07,15 GET M.DIRECCION
      @ 08,15 GET M.TELEFONO
      @ 09,15 GET M.ISLR PICTURE "999.99"
      @ 10,15 GET M.AREA
      READ
      *** INICIO RUTINA DE ACEPTAR-CANCELAR
      store 1 to wop
      do while .t.
         @ 11,22  get wop pict "@*H Aceptar;Cancelar" defa wop
         read
         if lastkey()=13
            exit
         endif
      enddo
      *** FIN  RUTINA ACEPTAR-CANCELAR
      if wop=1
         if filloc()
            append blank
            gath memvar
            unlock all
         else
            store "OPERACION CANCELADA, REINTENTE" to wtext
            do aviso with wtext
         endif
      endif
   ENDIF
ENDDO
RELEASE WIND WINCMED
RETURN
***************
PROCEDURE BRMOD
***************
DEFI WIND WMODMED FROM LIBRMED+4,CIBRMED+10 TO LIBRMED+17,CIBRMED+75;
                  TITLE " MODIFICAR PERSONAL " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WMODMED
SCAT MEMVAR
@ 00,01 SAY "CODIGO      :"
@ 01,01 SAY "NOMBRE      :"
@ 02,01 SAY "ESPECIALIDAD:"
@ 03,01 SAY "No.COLEGIO  :"
@ 04,01 SAY "No.M.S.A.S. :"
@ 05,01 SAY "USUARIO     :"
@ 06,01 SAY "CEDULA      :"
@ 07,01 SAY "DIRECCION   :"
@ 08,01 SAY "TELEFONO    :"
@ 09,01 SAY "I.S.L.R.    :"
@ 10,01 SAY "AREA DE SERV:"
@ 00,15 SAY M.MEDICO
@ 01,15 GET M.NOMBRE
@ 01,20 SAY SYSESP.DESCRI
@ 02,15 GET M.ESPECI    VALID VALESP()
@ 03,15 GET M.COLEGIO   
*VALID VALCOL()
@ 04,15 GET M.MSAS      
*VALID VALSAS()
@ 05,15 GET M.USERCODE  
*VALID VALUSE()
@ 06,15 GET M.CEDULA    
*VALID VALCED()
@ 07,15 GET M.DIRECCION
@ 08,15 GET M.TELEFONO
@ 09,15 GET M.ISLR PICTURE "999.99"
@ 10,15 GET M.AREA
IF WACCESO="A".OR.(WFLAGMED.AND.M.USERCODE=WUSERCODE)
   READ
ELSE
   CLEAR GETS
   STORE "OPRIMA <ENTER> PARA CONTINUAR" TO WTEXT
   DO AVISO WITH WTEXT
   RELEASE WIND WMODMED
   RETURN
ENDIF
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 11,22  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      gath memvar
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
RELEASE WIND WMODMED
RETURN
****************
PROCEDURE BRELI
****************
IF WACCESO<>"A"
   RETURN
ENDIF
DEFI WIND WELIMED FROM LIBRMED+4,CIBRMED+10 TO LIBRMED+17,CIBRMED+75;
                  TITLE " ELIMINAR PERSONAL " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WELIMED
SCAT MEMVAR
@ 00,01 SAY "CODIGO      :"
@ 01,01 SAY "NOMBRE      :"
@ 02,01 SAY "ESPECIALIDAD:"
@ 03,01 SAY "No.COLEGIO  :"
@ 04,01 SAY "No.M.S.A.S. :"
@ 05,01 SAY "USUARIO     :"
@ 06,01 SAY "CEDULA      :"
@ 07,01 SAY "DIRECCION   :"
@ 08,01 SAY "TELEFONO    :"
@ 09,01 SAY "I.S.L.R.    :"
@ 00,15 SAY M.MEDICO
@ 01,15 SAY M.NOMBRE
@ 02,15 SAY SYSESP.DESCRI
@ 03,15 SAY M.COLEGIO
@ 04,15 SAY M.MSAS
@ 05,15 SAY M.USERCODE
@ 06,15 SAY M.CEDULA
@ 07,15 SAY M.DIRECCION
@ 08,15 SAY M.TELEFONO
@ 09,15 SAY M.ISLR
@ 10,15 SAY M.AREA
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 2 to wop
do while .t.
   @ 11,22  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      delete
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
RELEASE WIND WELIMED
RETURN
***
PROCEDURE BRBUS
DEFI WIND WBUSMED FROM LIBRMED+4,CIBRMED+10 TO LIBRMED+17,CIBRMED+75;
                  TITLE " BUSCAR PERSONAL " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WBUSMED
DO WHILE .T.
   SCAT MEMV BLANK
   @ 00,01 SAY "CODIGO      :"
   @ 01,01 SAY "NOMBRE      :"
   @ 02,01 SAY "ESPECIALIDAD:"
   @ 00,15 GET M.MEDICO
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF LEN(ALLTRIM(M.MEDICO))=0
      LOOP
   ENDIF
   SEEK M.MEDICO
   IF FOUND()
      EXIT
   ELSE
      STORE "NO REGISTRADO, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
   ENDIF
ENDDO
RELEASE WIND WBUSMED
RETURN
***
PROCEDURE BRORD
* SET ORDER TO ??
RETURN
******************
FUNCTION VALESP
SELECT SYSESP
SEEK M.ESPECI
IF FOUND()
   @ 2,20 SAY DESCRI
   select sysmed
   RETURN .T.
ELSE
   libresp=10
   cibresp=10
   do sys0105
   store especi to m.especi
   @ 2,20 SAY DESCRI
   select sysmed
   return .t.
ENDIF
***********
FUNC VALCOL
STORE .F.     TO WFLAGERR
STORE RECNO() TO WREGMED
GO TOP
DO WHILE .NOT. EOF()
   IF COLEGIO<>SPACE(10).AND.COLEGIO=M.COLEGIO.AND.RECNO()<>WREGMED
      STORE .T. TO WFLAGERR
   ENDIF
   SKIP
ENDDO
GO WREGMED
IF WFLAGERR
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
***************
FUNC VALSAS
STORE .F.     TO WFLAGERR
STORE RECNO() TO WREGMED
GO TOP
DO WHILE .NOT. EOF()
   IF MSAS<>SPACE(10).AND.MSAS=M.MSAS.AND.RECNO()<>WREGMED
      STORE .T. TO WFLAGERR
   ENDIF
   SKIP
ENDDO
GO WREGMED
IF WFLAGERR
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
***************
FUNC VALUSE
STORE .F.     TO WFLAGERR
STORE RECNO() TO WREGMED
GO TOP
DO WHILE .NOT. EOF()
   IF USERCODE<>SPACE(8).AND.USERCODE=M.USERCODE.AND.RECNO()<>WREGMED
      STORE .T. TO WFLAGERR
   ENDIF
   SKIP
ENDDO
GO WREGMED
IF WFLAGERR
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
***************
FUNC VALCED
STORE .F.     TO WFLAGERR
STORE RECNO() TO WREGMED
GO TOP
DO WHILE .NOT. EOF()
   IF CEDULA<>SPACE(12).AND.CEDULA=M.CEDULA.AND.RECNO()<>WREGMED
      STORE .T. TO WFLAGERR
   ENDIF
   SKIP
ENDDO
GO WREGMED
IF WFLAGERR
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
***************
