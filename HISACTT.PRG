IF WACCESO<>"A"
   RETURN
ENDIF
SELECT 20
USE
*** FIN CONTROL DE ACCESO
DO WHILE .T.
   ON KEY LABEL F1
   ON KEY LABEL F2
   ON KEY LABEL F3
   ON KEY LABEL F4
   
   ***
   STORE 5  TO LIBRGRU
   STORE 5  TO CIBRGRU
   DO HISWINGR
   
   ***
   STORE 6  TO LIBRSUB
   STORE 5  TO CIBRSUB
   DO HISWINSU
   IF EOF().OR.ESTSUB=" "
      EXIT
   ENDIF
   IF ESTSUB<>"T"
      STORE "SUBACTIVIDAD SELECCIONADA NO ESTA DEFINIDA CON ESTRUCTURA X RENGLONES" TO WTEXT
      DO AVISO WITH WTEXT
      DEACT WIND ALL
      RETURN
   ENDIF

   ***
   STORE 7  TO LIBRREN
   STORE 5  TO CIBRREN
   DO HISWINRE
   IF EOF().OR.ESTREN=" "
      EXIT
   ENDIF
   IF ESTREN<>"T"
      STORE "RENGLON SELECCIONADO NO ESTA DEFINIDO CON ESTRUCTURA TABULADA" TO WTEXT
      DO AVISO WITH WTEXT
      DEACT WIND ALL
      RETURN
   ENDIF
   ***
   STORE 8  TO LIBRTAB
   STORE 5  TO CIBRTAB
   SELECT HISTAB
   ON KEY LABEL F1 DO BRINC
   ON KEY LABEL F2 DO BRMOD
   ON KEY LABEL F3 DO BRELI
   ON KEY LABEL F4 DO BRBUS
   DEFI WIND BRTAB FROM LIBRTAB,CIBRTAB TO LIBRTAB+10,CIBRTAB+55 ;
                   TITLE " RENGLON "+RTRIM(HISREN.DESREN)+" ";
                   FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,ESC=Sel ";
                   DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
   ACTI WIND BRTAB
   BROWSE FIELDS CODTAB:H="TABULADOR", DESTAB:H="DESCRIPCION";
                 FOR CODGRU=HISGRU.CODGRU.AND.CODSUB=HISSUB.CODSUB.AND.CODREN=HISREN.CODREN;
                 NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW BRTAB
   *** INICIO RUTINA DE ACEPTAR-CANCELAR
   store 1 to wop
   do while .t.
      @ 4,15 get wop pict "@*H Continuar;Abandonar" defa wop
      read
      if lastkey()=13
         exit
      endif
   enddo
   IF WOP=2
      EXIT
   ENDIF
   **** FIN  RUTINA ACEPTAR-CANCELAR
ENDDO
RELEASE WIND BRGRU
RELEASE WIND BRSUB
RELEASE WIND BRREN
RELEASE WIND BRTAB
ON KEY LABEL F1
ON KEY LABEL F2
ON KEY LABEL F3
ON KEY LABEL F4
ON KEY LABEL F10
RETURN
***********************
***                 ***
***RUTINAS DE BRTAB ***
***                 ***
***********************
PROCEDURE BRINC
DEFI WIND WINCTAB FROM LIBRTAB+1,CIBRTAB TO LIBRTAB+15,CIBRTAB+90;
                  TITLE " INCLUIR TABULADOR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCTAB
DO WHILE .T.
   SCAT MEMV BLANK
   STORE HISGRU.CODGRU TO M.CODGRU
   STORE HISSUB.CODSUB TO M.CODSUB
   STORE HISREN.CODREN TO M.CODREN
   @ 00,00 CLEAR
   @ 00,01 SAY "TABULADOR   :"
   @ 02,01 SAY "LINEAS      :"
   @ 03,01 SAY "COLUMNAS    :"
   @ 04,01 SAY "TIPO DE DATO:"
   @ 05,01 SAY "VALIDO DESDE:"
   @ 06,01 SAY "VALIDO HASTA:"
   @ 07,01 SAY "UNIDAD      :"
   @ 08,01 SAY "VALOR NORMAL:"
   @ 00,14 GET M.CODTAB
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE M.CODGRU+M.CODSUB+M.CODREN+M.CODTAB TO WCLAVE
   IF LEN(TRIM(WCLAVE))=0
      LOOP
   ENDIF
   SEEK WCLAVE
   IF FOUND()
      @ 01,14 SAY DESTAB
      STORE "YA EXISTE, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      LOOP
   ELSE
      @ 00,18 GET M.DESTAB
      @ 02,14 GET M.LONTAB pict "99"
      @ 03,14 GET M.ANCTAB pict "99"
      @ 04,14 GET M.TIPVAL
      @ 05,14 GET M.VL1TAB
      @ 06,14 GET M.VL2TAB
      @ 07,14 GET M.UNDTAB
      @ 08,14 GET M.VALNOR
      READ
      *** INICIO RUTINA DE ACEPTAR-CANCELAR
      store 1 to wop
      do while .t.
         @ 10,18  get wop pict "@*H Aceptar;Cancelar" defa wop
         read
         if lastkey()=13
            exit
         endif
      enddo
      *** FIN  RUTINA ACEPTAR-CANCELAR
      if wop=1
         if filloc()
            append blank
            gath memvar
            unlock all
         else
            store "OPERACION CANCELADA, REINTENTE" to wtext
            do aviso with wtext
         endif
      endif
   ENDIF
ENDDO
RELEASE WIND WINCTAB
RETURN
********************
PROCEDURE BRMOD
DEFI WIND WMODTAB FROM LIBRTAB+1,CIBRTAB TO LIBRTAB+15,CIBRTAB+90;
                  TITLE " MODIFICAR TABULADOR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WMODTAB
SCAT MEMV
@ 00,00 CLEAR
@ 00,01 SAY "TABULADOR   :"
@ 02,01 SAY "LINEAS      :"
@ 03,01 SAY "COLUMNAS    :"
@ 04,01 SAY "TIPO DE DATO:"
@ 05,01 SAY "VALIDO DESDE:"
@ 06,01 SAY "VALIDO HASTA:"
@ 07,01 SAY "UNIDAD      :"
@ 08,01 SAY "VALOR NORMAL:"
@ 00,14 SAY M.CODTAB
@ 00,18 GET M.DESTAB
@ 02,14 GET M.LONTAB pict "99"
@ 03,14 GET M.ANCTAB pict "99"
@ 04,14 GET M.TIPVAL
@ 05,14 GET M.VL1TAB
@ 06,14 GET M.VL2TAB
@ 07,14 GET M.UNDTAB
@ 08,14 GET M.VALNOR
READ
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 10,18  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      gath memvar
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
RELEASE WIND WMODTAB
RETURN
********************
PROCEDURE BRELI
DEFI WIND WELITAB FROM LIBRSUB+1,CIBRSUB TO LIBRSUB+6,CIBRSUB+60;
                  TITLE " ELIMINAR TABULADOR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WELITAB
SCAT MEMV
@ 00,00 CLEAR
@ 00,01 SAY "TABULADOR  :"
@ 00,14 SAY M.CODTAB
@ 00,18 SAY M.DESTAB
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 02,18  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if filloc()
      delete
      unlock all
   else
      store "OPERACION CANCELADA, REINTENTE" to wtext
      do aviso with wtext
   endif
endif
RELEASE WIND WELITAB
RETURN
***************
PROCEDURE BRBUS
DEFI WIND WBUSTAB FROM LIBRTAB+1,CIBRTAB TO LIBRTAB+6,CIBRTAB+60;
                  TITLE " BUSCAR TABULADOR " DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WBUSTAB
SCAT MEMV BLANK
STORE HISGRU.CODGRU TO M.CODGRU
STORE HISSUB.CODSUB TO M.CODSUB
@ 00,00 CLEAR
@ 00,01 SAY "TABULADOR  :"
@ 00,14 GET M.CODTAB
READ
IF LASTKEY()=27
   RELEASE WIND WBUSTAB
   RETURN
ENDIF
STORE M.CODGRU+M.CODSUB+M.CODTAB TO WCLAVE
IF LEN(TRIM(WCLAVE))=0
   RELEASE WIND WBUSTAB
   RETURN
ENDIF
SEEK WCLAVE
IF FOUND()
   RELEASE WIND WBUSTAB
   RETURN
ELSE
   store "NO REGISTRADO, VERIFIQUE" to wtext
   do aviso with wtext
ENDIF
RELEASE WIND WBUSTAB
RETURN
********************
