SELECT FACCLI
SEEK FACCXC.CODCLI
IF FOUND()
   STORE DESCLI TO WQNOMCLI
ELSE
   STORE "?"    TO WQNOMCLI
ENDIF
DEFI WIND WINDA FROM 2,0 TO 21,79 TITLE " ABONAR A "+ALLTRIM(WQNOMCLI)+" ";
          DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND WINDA
STORE .T. TO CANCELING
DO WHILE CANCELING
   @ 0,00 CLEAR
   @ 0,01 SAY "LIN"
   @ 0,05 SAY "FECHA"
   @ 0,16 SAY "REFERENCIA"
   @ 0,42 SAY "       DEBE"
   @ 0,62 SAY "      HABER"
   SELECT FACCXC
   @ 2,01 SAY "  0"
   @ 2,05 SAY DTOC(ELABORADO)
   @ 2,16 SAY REFERENCIA
   @ 2,40 SAY TOTDOC PICTURE "999,999,999.99"
   STORE 0 TO WPAGADO
   STORE 0 TO WRENG
   STORE 2 TO WLINE
   SELECT FACCXCTR
   SET ORDER TO FACCXCT1
   SEEK FACCXC.CODCXC
   DO WHILE .NOT. EOF().AND.CODCXC=FACCXC->CODCXC
      STORE WRENG+1 TO WRENG
      STORE WLINE+1 TO WLINE
      IF WLINE>15
         STORE "OPRIMA <ENTER> PARA CONTINUAR" TO MES
         DO AVISO WITH MES
         @ 3,0 CLEAR
         STORE 3 TO WLINE
      ENDIF
      @ WLINE,01  SAY STR(WRENG,3)
      @ WLINE,05  SAY DTOC(FECHA)
      @ WLINE,16  SAY REFERENCIA
      @ WLINE,60  SAY MONTO PICTURE "999,999,999.99"
      STORE WPAGADO + MONTO TO WPAGADO
      STORE FECHA           TO WLASTPAG
      SKIP
   ENDDO
   *** ACTUALIZAR VALORES EN DOCUMENTO X COBRAR
   SELECT FACCXC
   STORE  TOTDOC - WPAGADO TO WSALDO
   @ 16,00  SAY REPLICATE(".",78)
   @ 17,01  SAY "S a l d o:"
   @ 17,40  SAY WSALDO PICTURE "999,999,999.99"
   IF RECLOC()
      IF WSALDO > 0
         REPLACE CANCELADO WITH CTOD("  -  -  ")
      ELSE
         REPLACE CANCELADO WITH WLASTPAG
      ENDIF
      UNLOCK ALL
      FLUSH
   ENDIF
   STORE WRENG + 1 TO WCHOICEX
   @ 15,01 get WCHOICEX PICTURE "##"
   READ
   IF LASTKEY() = 27
      STORE .F. TO CANCELING
      LOOP
   ENDIF
   *** BUSQUEDA DE LA LINEA SELECCIONADA
   STORE 0 TO WSEL
   STORE .F. TO WENCONTRADO
   SELECT FACCXCTR
   SET ORDER TO FACCXCT1
   SEEK FACCXC->CODCXC
   DO WHILE .NOT. EOF().AND.CODCXC=FACCXC->CODCXC
      STORE WSEL+1 TO WSEL
      IF WSEL = WCHOICEX
         STORE .T. TO WENCONTRADO
         EXIT
      ENDIF
      SKIP
   ENDDO
   IF WENCONTRADO
      STORE "ELIMINAR ? (S/N) " TO TEX
      STORE "NS" TO WCH
      *STORE "N"   TO WCH
      DO PREGUNTA
      IF WCH = "S"
         IF FILLOC()
            DELETE
            UNLOCK ALL
            FLUSH
         ENDIF
      ENDIF
      LOOP
   ELSE
      STORE DATE()     TO WFECHA
      STORE WSALDO     TO WMONTO
      STORE 0          TO WLASTMONTO
      STORE SPACE(10)  TO WREFERENCIA
   ENDIF
   @ WLINE+1,01  SAY STR(WCHOICEX,3)
   @ WLINE+1,05  GET WFECHA
   @ WLINE+1,16  GET WREFERENCIA
   @ WLINE+1,60  GET WMONTO PICTURE "999,999,999.99"
   READ
   IF WMONTO > WSALDO+WLASTMONTO
      STORE "MONTO EXEDE SALDO. SERA AJUSTADO A :"+STR((WSALDO+WLASTMONTO),12,2) TO MES
      DO AVISO WITH MES
      STORE WSALDO+WLASTMONTO TO WMONTO
   ENDIF
   STORE "CONFORME? (S/N)" TO TEX
   STORE "SN" TO WCH
   DO PREGUNTA
   IF WCH = "S"
      SELECT FACCXCTR
      IF FILLOC()
         APPEND BLANK
         REPLACE CODCXC      WITH FACCXC->CODCXC
         REPLACE FECHA       WITH WFECHA
         REPLACE REFERENCIA  WITH WREFERENCIA
         REPLACE MONTO       WITH WMONTO
         REPLACE ORIGEN      WITH "CXC"
         REPLACE DEPTO       WITH WUSERUBI
         REPLACE USUARIO     WITH WUSERCODE
         REPLACE USUARIOF    WITH DATE()
         UNLOCK ALL
         FLUSH
      ENDIF
      DO PROGEVER
   ENDIF
   SELECT FACCXC
ENDDO
SELECT FACCXC
DEAC WIND WINDA
RETURN   
******************
PROCEDURE PROGEVER
******************
PUSH KEY CLEAR
DEFI WIND WINDVER FROM 12,19 TO 14,59;
          TITLE " SALIDA ";
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDVER
DO WHILE .T.
   STORE 1 TO WOP
   @ 00,03 SAY "OPCIONES: ";
   GET WOP PICT "@*H IMPRESORA;MONITOR   "
   READ
   IF LASTKEY()=13
      EXIT
   ENDIF
ENDDO
RELE WIND WINDVER
STORE WOP TO WSALIDA
DO FACIMPRE
SELECT FACCXCTR
POP KEY
RETURN
