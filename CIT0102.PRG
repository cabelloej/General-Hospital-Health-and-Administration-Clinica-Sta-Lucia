
DO WHILE .T.
   SELECT CITOCU
   @ 05,00 CLEAR
   @ 05,00 TO 22,79
   @ 05,26 SAY "< OCUPACION MEDICA DE CONSULTORIOS >"
   STORE .F. TO WFLAGCON
   @ 07,05 SAY "CONSULTORIO:" GET WCONSUL VALID VALCON()
   READ
   IF LASTKEY()=27.AND..NOT. WFLAGCON
      EXIT
   ENDIF
   @ 07,23 SAY SYSCON.DESCRI
   @ 07,55 SAY "DIA No.:" GET WDIA VALID VALDIA()
   READ
   IF LASTKEY()=27
      LOOP
   ENDIF
   @ 07,68 SAY WDIADES
   SELECT CITOCU
   DEFI WIND BROCU FROM LIBROCU+4,CIBROCU+10 TO LIBROCU+16,CIBROCU+70 ;
                   TITLE " HORARIO " ;
                   FOOTER " F1=Inc,F3=Eli,ESC=Sel ";
                   DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
   ACTI WIND BROCU
   ON KEY LABEL F1 DO BRINC
   ON KEY LABEL F2
   ON KEY LABEL F3 DO BRELI
   ON KEY LABEL F4
   ON KEY LABEL F5
   BROWSE FIELDS DESDEH:H="Hr.Ent", DESDEM:H="Mn.Ent", HASTAH:H="Hr.Sal", HASTAM:H="Mn.Sal", sysmed.nombre:H="Medico", libre:h="ASIG.LIBRE?";
                 NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW BROCU;
                 FOR CITOCU.CONSUL=WCONSUL.AND.CITOCU.DIA=WDIA
  *BROWSE FIELDS CONSUL:H="No.",SYSCON.DESCRI:H="Descripcion", DIA:H="Dia", DESDEH:H="Hr.Ent",;
   ON KEY LABEL F1
   ON KEY LABEL F2
   ON KEY LABEL F3
   ON KEY LABEL F4
   ON KEY LABEL F5
   RELEASE WIND BROCU
ENDDO
RETURN
***********************
***                 ***
***RUTINAS DE BROCU ***
***                 ***
***********************
PROCEDURE BRINC
STORE .T. TO WINC
DEFI WIND WINC FROM LIBROCU+10,CIBROCU+10 TO LIBROCU+15,CIBROCU+70;
               TITLE " INCLUIR OCUPACION" DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINC
DO WHILE WINC
   SCAT MEMV BLANK
   @ 00,00 CLEAR
   @ 00,01 SAY "Hr:Mn  Entrada:  :   "
   @ 01,01 SAY "Hr:Mn  Salida :  :   "
   @ 02,01 SAY "Medico        :      "
   @ 03,01 SAY "Asig.Libre S/N:      "
   STORE .F. TO WFLAGCON
   SELECT CITOCU
   WTOPH   = 00
   WTOPM   = 00
   WBOTH   = 23
   WBOTM   = 59
   STORE .F. TO WFLAGMED
   @ 00,17 GET M.DESDEH  PICTURE "99"  VALID VALDH()
   @ 00,20 GET M.DESDEM  PICTURE "99"  VALID VALDM()
   @ 01,17 GET M.HASTAH  PICTURE "99"  VALID VALHH()
   @ 01,20 GET M.HASTAM  PICTURE "99"  VALID VALHM()
   @ 02,17 GET WMEDICO    VALID VALMED()
   @ 03,17 GET M.LIBRE
   READ
   IF LASTKEY()=27.AND..NOT.WFLAGMED
      RELE WIND WINC
      EXIT
   ENDIF
   *** INICIO RUTINA DE ACEPTAR-CANCELAR
   store 1 to wop
   do while .t.
      @ 03,20  get wop pict "@*H Aceptar;Cancelar" defa wop
      read
      if lastkey()=13
         exit
      endif
   enddo
   *** FIN  RUTINA ACEPTAR-CANCELAR
   if wop=1
      select citocu
      if filloc()
         append blank
         STORE WCONSUL TO M.CONSUL
         STORE WDIA    TO M.DIA
         STORE WMEDICO TO M.MEDICO
         gath memvar
         unlock all
      endif
   endif
ENDDO
RETURN
***
PROCEDURE BRELI
DEFI WIND WELI FROM LIBROCU+10,CIBROCU+10 TO LIBROCU+15,CIBROCU+70;
               TITLE " ELIMINAR OCUPACION" DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WELI
SELECT CITOCU
SCAT MEMV
@ 00,00 CLEAR
@ 00,01 SAY "Hr:Mn  Entrada:  :   "
@ 01,01 SAY "Hr:Mn  Salida :  :   "
@ 02,01 SAY "Medico        :      "
@ 03,01 SAY "Asig.Libre S/N:      "
@ 00,17 SAY M.DESDEH  PICTURE "99"
@ 00,20 SAY M.DESDEM  PICTURE "99"
@ 01,17 SAY M.HASTAH  PICTURE "99"
@ 01,20 SAY M.HASTAM  PICTURE "99"
@ 02,17 SAY M.MEDICO
@ 03,17 SAY M.LIBRE
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 03,20  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      delete
      unlock all
   endif
endif
RELEASE WIND WELI
RETURN
***
****************************
*  FUNCIONES DE VALIDACION *
****************************
***********
FUNC VALCON
SELECT SYSCON
SEEK WCONSUL
IF .NOT.FOUND()
   STORE LIBROCU+3 TO LIBRCON
   STORE CIBROCU+5 TO CIBRCON
   DO SYS0104
   STORE SYSCON.CONSUL TO WCONSUL
   STORE .T. TO WFLAGCON
ELSE
   @ 00,25 SAY SYSCON.DESCRI
ENDIF
RETURN .T.
***********
FUNC VALDIA
IF WDIA<"1".OR.WDIA>"7"
   RETURN .F.
ELSE
   DO CASE
      CASE WDIA = "1"
           STORE "Domingo  "    to wdiades
      CASE WDIA = "2"
           STORE "Lunes    "    to wdiades
      CASE WDIA = "3"
           STORE "Martes   "    to wdiades
      CASE WDIA = "4"
           STORE "Miercoles"    to wdiades
      CASE WDIA = "5"
           STORE "Jueves   "    to wdiades
      CASE WDIA = "6"
           STORE "Viernes  "    to wdiades
      CASE WDIA = "7"
           STORE "Sabado   "    to wdiades
   ENDCASE
   RETURN .T.
ENDIF
RETURN
******
FUNC VALDH
IF M.DESDEH<0.OR.M.DESDEH>23
   RETURN .F.
ELSE
   RETURN .T.
ENDIF
RETURN
******
FUNC VALDM
IF M.DESDEM<0.OR.M.DESDEM>59
   RETURN .F.
ENDIF
SELECT CITOCU
STORE WCONSUL+WDIA TO WCLAVECD
SEEK WCLAVECD
IF FOUND()
   DO WHILE .NOT.EOF().AND.CONSUL=WCONSUL.AND.DIA=WDIA
      IF (DESDEH>M.DESDEH).OR.(DESDEH=M.DESDEH.AND.DESDEM>M.DESDEM)
         STORE DESDEH  TO WBOTH
         STORE DESDEM  TO WBOTM
      ELSE
         STORE HASTAH TO WTOPH
         STORE HASTAM TO WTOPM
      ENDIF
      SKIP
   ENDDO
ENDIF
IF (M.DESDEH>WTOPH).OR.(M.DESDEH=WTOPH.AND.M.DESDEM>=WTOPM)
   RETURN .T.
ELSE
   STORE "CONSULTORIO OCUPADO A ESTA HORA DE ENTRADA, VERIFIQUE" TO WTEXT
   DO AVISO WITH WTEXT
   *RETURN .F.
   RETURN .T.
ENDIF
RETURN
**********
FUNC VALHH
IF (M.HASTAH<=WBOTH)
   RETURN .T.
ELSE
   STORE "CONSULTORIO OCUPADO A ESTA HORA DE SALIDA, VERIFIQUE" TO WTEXT
   DO AVISO WITH WTEXT
   *RETURN .F.
   RETURN .T.
ENDIF
RETURN
**********
FUNC VALHM
IF (M.HASTAH<WBOTH).OR.(M.HASTAH=WBOTH.AND.M.HASTAM<=WBOTM)
   RETURN .T.
ELSE
   STORE "CONSULTORIO OCUPADO A ESTA HORA DE SALIDA, VERIFIQUE" TO WTEXT
   DO AVISO WITH WTEXT
   *RETURN .F.
   RETURN .T.
ENDIF
RETURN
******
FUNC VALMED
SELECT SYSMED
SEEK WMEDICO
IF .NOT.FOUND()
   STORE LIBROCU+3 TO LIBRMED
   STORE CIBROCU+5 TO CIBRMED
   DO SYS0107
   STORE SYSMED.MEDICO TO WMEDICO
   STORE .T. TO WFLAGMED
ENDIF
@ 02,25 SAY SYSMED.NOMBRE
RETURN .T.

