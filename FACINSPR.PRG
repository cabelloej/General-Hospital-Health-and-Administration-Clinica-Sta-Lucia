STORE ADMADM.REFERE TO WADMPRE
SELECT FACPREGE
SET ORDER TO FACPREG1
SEEK WADMPRE
IF .NOT. FOUND()
   RETURN
ENDIF
STORE NOMTRA1 TO WNOMTRA1
STORE NOMTRA2 TO WNOMTRA2
SELECT FACPREDE
SEEK WADMPRE
DO WHILE .NOT. EOF() .AND. NUMERO=WADMPRE
   STORE TIPITEM    TO WTIPITEM
   STORE ITEM       TO WITEM
   STORE CANTIDAD   TO WCANTIDAD
   STORE PRECIO     TO WPRECIO
   STORE DESCUENTO  TO WDESCUENTO
   SELECT FACDCDE
   IF FILLOC()
      APPEND BLANK
      REPLACE NUMERO     WITH WNUMERO2
      REPLACE TIPITEM    WITH WTIPITEM
      REPLACE ITEM       WITH WITEM
      REPLACE CANPRE     WITH WCANTIDAD
      REPLACE CANTIDAD   WITH 0
      REPLACE PRECIO     WITH WPRECIO
      REPLACE DESCUENTO  WITH WDESCUENTO

      REPLACE ORIGEN     WITH "FAC"
      REPLACE DEPTO      WITH WUSERUBI
      REPLACE USUARIO    WITH WUSERCODE
      REPLACE USUARIOF   WITH DATE()
      UNLOCK
   ELSE
      STORE "OPERACION ABORTADA, REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   SELECT FACPREDE
   SKIP
ENDDO
*** CREA DATOS GENERALES DE FACTURA
SELECT FACDCGE
SEEK WNUMERO2
IF .NOT.FOUND()
   IF FILLOC()
      APPEND BLANK
      REPLACE NUMERO     WITH WNUMERO2
      REPLACE NOMTRA1    WITH WNOMTRA1
      REPLACE NOMTRA2    WITH WNOMTRA2
      UNLOCK ALL
   ENDIF
ENDIF
RETURN

