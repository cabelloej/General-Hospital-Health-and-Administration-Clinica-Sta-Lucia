SELECT AFIPLAND
DEFI WIND BRPD FROM LIBRPLA,CIBRPLA+34 TO LIBRPLA+16,CIBRPLA+79;
               TITLE " RENGLONES DEL PLAN " ;
               FOOTER " F1=Inc,F2=Mod,F3=Eli,F4=Bus,ESC=Sel ";
               DOUBLE NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND BRPD
ON KEY LABEL F1 DO BRINC
ON KEY LABEL F2 DO BRMOD
ON KEY LABEL F3 DO BRELI
ON KEY LABEL F4 DO BRBUS
ON KEY LABEL F5 DO BRORD
BROWSE FIELDS WSERV=FUNSER():H="AREA",CANTIDAD:H="    N§",DESCUENTO:H="    %",COBERTURA:H="         Bs.";
       FOR PLAN=AFIPLANG.PLAN;
       NOAPPEND NODELETE NOEDIT NOCLEAR NOMENU NOOPTIMIZE;
       REST IN WINDOW BRPD
RELEASE WIND BRPD
RETURN
***********
FUNC FUNSER
***********
STORE SUBSTR(SYSPTO.DESCRI,1,15) TO WSERV
RETURN  WSERV
**********************
*** RUTINAS DE BRPD***
**********************
PROCEDURE BRINC
DEFI WIND WINCPD FROM LIBRPLA+03,CIBRPLA+34 TO LIBRPLA+06,CIBRPLA+79;
                 TITLE " INCLUIR RENGLON DEL PLAN";
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCPD
DO WHILE .T.
   SELECT AFIPLAND
   SCAT MEMV BLANK
   STORE SPACE(1) TO WDESSER
   STORE AFIPLANG.PLAN TO M.PLAN
   STORE .F. TO WFLAGSER
   @ 00,00 CLEAR
   @ 00,01 GET M.CODPTO VALID VALPTO()
   READ
   IF .NOT.WFLAGSER.AND.LASTKEY()=27
      EXIT
   ENDIF
   STORE M.PLAN+M.CODPTO TO WCLAVEPLAD
   IF LEN(TRIM(WCLAVEPLAD))=0
      LOOP
   ENDIF
   SELECT AFIPLAND
   SEEK WCLAVEPLAD
   IF FOUND()
      @ 00,01 SAY SYSPTO.DESCRI
      STORE "YA EXISTE, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      LOOP
   ELSE
      @ 00,01 SAY WDESSER
      @ 00,15 GET M.CANTIDAD PICTURE "99999.99"
      READ
      IF M.CANTIDAD=0
         @ 00,24 GET M.DESCUENTO PICTURE "999.99"
         READ
         IF M.DESCUENTO=0
            @ 00,31 GET M.COBERTURA PICTURE "999999999.99"
            READ
         ELSE
            STORE 0 TO M.COBERTURA
         ENDIF
      ELSE
         STORE 0 TO M.DESCUENTO
         STORE 0 TO M.COBERTURA
      ENDIF
      *** INICIO RUTINA DE ACEPTAR-CANCELAR
      store 1 to wop
      do while .t.
         @ 01,12  get wop pict "@*H Aceptar;Cancelar" defa wop
         read
         if lastkey()=13
            exit
         endif
      enddo
      *** FIN  RUTINA ACEPTAR-CANCELAR
      if wop=1
         if filloc()
            append blank
            gath memvar
            unlock all
         endif
      endif
   ENDIF
ENDDO
RELE WIND WINCPD
RETURN
**********************
PROCEDURE BRMOD
IF EOF()
   RETURN
ENDIF
DEFI WIND WMODPD FROM LIBRPLA+03,CIBRPLA+34 TO LIBRPLA+06,CIBRPLA+79;
                 TITLE " MODIFICAR RENGLON DEL PLAN";
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WMODPD
SCAT MEMVAR
@ 00,01 SAY SYSPTO.DESCRI
@ 00,15 GET M.CANTIDAD PICTURE "99999.99"
READ
IF M.CANTIDAD=0
   @ 00,24 GET M.DESCUENTO PICTURE "999.99"
   READ
   IF M.DESCUENTO=0
      @ 00,31 GET M.COBERTURA PICTURE "999999999.99"
      READ
   ELSE
      STORE 0 TO M.COBERTURA
   ENDIF
ELSE
   STORE 0 TO M.DESCUENTO
   STORE 0 TO M.COBERTURA
ENDIF
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 1 to wop
do while .t.
   @ 01,12  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      gath memvar
      unlock all
   endif
endif
RELEASE WIND WMODPD
RETURN
**********************
PROCEDURE BRELI
DEFI WIND WELIPD FROM LIBRPLA+03,CIBRPLA+34 TO LIBRPLA+06,CIBRPLA+79;
                 TITLE " ELIMINAR RENGLON DEL PLAN";
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WELIPD
@ 00,01 SAY SYSPTO.DESCRI
@ 00,18 SAY DESCUENTO PICTURE "999.99"
@ 00,26 SAY COBERTURA PICTURE "999999999.99"
*** INICIO RUTINA DE ACEPTAR-CANCELAR
store 2 to wop
do while .t.
   @ 01,12  get wop pict "@*H Aceptar;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
*** FIN  RUTINA ACEPTAR-CANCELAR
if wop=1
   if recloc()
      delete
      unlock all
   endif
endif
RELEASE WIND WELIPD
RETURN
**********************
PROCEDURE BRBUS
DEFI WIND WBUSPD FROM LIBRPLA+03,CIBRPLA+34 TO LIBRPLA+06,CIBRPLA+79;
                 TITLE " BUSCAR RENGLON DEL PLAN";
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WBUSPD
SCAT MEMVAR
@ 00,01 GET M.CODPTO
READ
IF LASTKEY()=27
   RELEASE WIND WBUSPD
   RETURN
ENDIF
STORE AFIPLANG.PLAN+M.CODPTO TO WCLAVEPLAD
IF LEN(TRIM(WCLAVEPLAD))=0
   RELEASE WIND WBUSPD
   RETURN
ENDIF
SELECT AFIPLAND
SEEK WCLAVEPLAD
IF FOUND()
   RELEASE WIND WBUSPD
   RETURN
ELSE
   STORE "NO REGISTRADO, VERIFIQUE" TO WTEXT
   DO AVISO WITH WTEXT
   RELEASE WIND WBUSPD
   RETURN
ENDIF
**********************
PROCEDURE BRORD
RETURN
**********************
FUNCTION VALPTO
SELECT SYSPTO
SEEK M.CODPTO
IF.NOT.FOUND()
   librpto=10
   cibrpto=0
   do sys0101
   store .t. to wflagser
   STORE SYSPTO.CODPTO TO M.CODPTO
ENDIF
STORE SYSPTO.DESCRI TO WDESSER
SELECT AFIPLAND
RETURN .T.

