do while sys(13) <> "READY"
   store "PREPARE LA IMPRESORA Y OPRIMA <ENTER>" TO WTEXT
   do aviso with wtext
   retry
enddo
CLOSE DATA
CLOSE INDEX
STORE WUSERCODE TO WUSUARIO
STORE 0 TO WCONT
USE SYSERROR
DO WHILE .T.
   IF FLOCK()
      APPEND BLANK
      REPLACE FECHA      WITH DATE()
      REPLACE USUARIO    WITH WUSERCODE
      REPLACE ERROR      WITH ERROR()
      REPLACE MENSAJE    WITH MENSSGE(0)
      REPLACE TEXTO      WITH MENSSAGE(1)
      REPLACE LINEA      WITH LINENO()
      REPLACE PROGRAMA   WITH SYS(16,4)
      EXIT
   ELSE
      STORE WCONT+1 TO WCONT
   ENDIF
   IF WCONT>300
      EXIT
   ENDIF
ENDDO
UNLOCK ALL
CLOSE DATA
CLOSE INDEX
DEACT WIND ALL
RELEASE ALL
CLEAR ALL
RETURN TO MASTER

*STORE "ERROR IRRECUPERABLE No "+STR(ERROR(),5)+" , EL SISTEMA SE REINICIALIZARA. <ENTER>" TO MES
*DO AVISO WITH MES
*SELECT 25
*USE SYSERR
*APPEND BLANK
*REPLACE NUMERO   WITH ERROR()
*REPLACE MENSAJE  WITH MESSAGE()
*REPLACE PROGRAMA WITH SYS(16,4)
*REPLACE USUARIO  WITH WUSERCODE
*REPLACE FECHA    WITH DATE()
*REPLACE HORA     WITH TIME()
*UNLOCK ALL
*CLOSE DATA
*CLOSE INDEX
*DEACT WIND ALL
*RELEASE ALL
*CLEAR ALL
*RETURN TO MASTER
*******************
*PROCEDURE SYSERROR
*PARAMETERS WFECHA,WUSERCODE,WERROR,WMENSAJE0,WMENSAJE1,WLINENO,WPROGRAM
*CLOSE DATA
*CLOSE INDEX
*STORE 0 TO WCONT
*USE SYSERROR
*DO WHILE .T.
*   IF FLOCK()
*      APPEND BLANK
*      REPLACE FECHA      WITH WFECHA
*      REPLACE USUARIO    WITH WUSERCODE
*      REPLACE ERROR      WITH WERROR
*      REPLACE MENSAJE    WITH WMENSAJE0
*      REPLACE TEXTO      WITH WMENSAJE1
*      REPLACE LINEA      WITH WLINENO
*      REPLACE PROGRAMA   WITH WPROGRAM
*      EXIT
*   ELSE
*      STORE WCONT+1 TO WCONT
*   ENDIF
*   IF WCONT>300
*      EXIT
*   ENDIF
*ENDDO
*UNLOCK ALL
*CLOSE DATA
*CLOSE INDEX
*DEACT WIND ALL
*RELEASE ALL
*CLEAR ALL
*RETURN TO MASTER
******************
