PROCEDURE INDICES
DEFI WIND WININD FROM 05,55 TO 07,79 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,01  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00
   @ 00,01  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00
   @ 00,02 SAY "Favor esperar..."
else
   RELE WIND WININD
   RETURN
endif
*
CLOSE DATA
CLOSE INDEX
*
SELECT 1
USE FACGRU
INDEX ON CODGRU                TO FACGRU
*
SELECT 1
USE FACCLI
INDEX ON CODCLI                TO FACCLI
*
SELECT 1
USE FACDCGE
INDEX ON NUMERO                  TO FACDCGE
INDEX ON REFERENCIA              TO FACDCGE2
INDEX ON STR(YEAR (ELABORADO),4)+;
         STR(MONTH(ELABORADO),2)+;
         STR(DAY  (ELABORADO),2) TO FACDCGE3
INDEX ON CODPAC                  TO FACDCGE4
*
SELECT 1
USE FACDCDE
INDEX ON NUMERO+TIPITEM+ITEM   TO FACDCDE
*
SELECT 1
USE FACPREGE
INDEX ON NUMERO                TO FACPREG1
INDEX ON CODCLI                TO FACPREG2
*
SELECT 1
USE FACPREDE
INDEX ON NUMERO+TIPITEM+ITEM   TO FACPREDE
*
SELECT 1
USE FACCXC
INDEX ON CODCXC                TO FACCXC1
INDEX ON CODCLI                TO FACCXC2
INDEX ON REFERENCIA            TO FACCXC3
*
SELECT 1
USE FACCXCTR
INDEX ON CODCXC                TO FACCXCT1
INDEX ON REFERENCIA            TO FACCXCT2
INDEX ON STR(YEAR (FECHA),4)+;
         STR(MONTH(FECHA),2)+;
         STR(DAY  (FECHA),2)   TO FACCXCT3
USE
*
RELE WIND WININD
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO MES
DO AVISO WITH MES
CLOSE DATA
CLOSE INDEX
SET PROC TO SYSPROC
RETURN TO MASTER
****************
PROCEDURE RECLOC
DEFI WIND WINRLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGRL
STORE .F. TO WRECMES
STORE .T. TO WRECLOC
DO WHILE WRECLOC
   IF RLOCK()
      STORE .T. TO WFLAGRL
      EXIT
   ELSE
      IF .NOT. WRECMES
         ACTI WIND WINRLOCK
         @ 02,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 03,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WRECMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINRLOCK
RETURN WFLAGRL
***************
PROCEDURE VACIA
***************
IF WUSERCODE <> "EDUARDO"
   RETURN
ELSE
   SELECT FACDATA
   IF RECLOC()
      REPLACE FACSERIFAC WITH 0
      REPLACE FACSERICXC WITH 0
      UNLOCK
   ELSE
      STORE "REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   SELECT FACDCGE
   IF FILLOC()
      ZAP
      UNLOCK ALL
   ELSE
      STORE "REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   SELECT FACDCDE
   IF FILLOC()
      ZAP
      UNLOCK ALL
   ELSE
      STORE "REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   SELECT FACCXC
   IF FILLOC()
      ZAP
      UNLOCK ALL
   ELSE
      STORE "REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   SELECT FACCXCTR
   IF FILLOC()
      ZAP
      UNLOCK ALL
   ELSE
      STORE "REINTENTE" TO MES
      DO AVISO WITH MES
      RETURN
   ENDIF
   STORE "OPERACION EFECTUADA SATISFACTORIAMENTE" TO MES
   DO AVISO WITH MES
   RETURN
ENDIF
******************************************************************************
PROCEDURE FILLOC
DEFI WIND WINFLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGFL
STORE .F. TO WFILMES
STORE .T. TO WFILLOC
DO WHILE WFILLOC
   IF FLOCK()
      STORE .T. TO WFLAGFL
      EXIT
   ELSE
      IF .NOT. WFILMES
         ACTI WIND WINFLOCK
         @ 02,15 SAY "ARCHIVO  OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 03,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WFILMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINFLOCK
RETURN WFLAGFL
***********************
PROCEDURE PREGUNTA
DEFI WIND WINPRE FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINPRE
STORE .T. TO WPREG
DO WHILE WPREG
   @ 0,0
   STORE SUBSTR(WCH,1,1) TO WCHOICE
   @ 0,40- (LEN(TEX)/2) SAY TEX GET WCHOICE
   READ
   IF AT(WCHOICE,WCH) > 0
      STORE .F. TO WPREG
      EXIT
   ENDIF
ENDDO
RELE WIND WINPRE
STORE WCHOICE TO WCH
RETURN
*************************
PROCEDURE MENSAJE
PARAMETERS MES
DEFI WIND WINMES FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINMES
@ 00,40-(LEN(MES)/2) SAY MES
RELE WIND WINMES
RETURN
*************************
PROCEDURE AVISO
PARAMETERS WTEXT
DEFI WIND WINAVI FROM 22,0 TO 24,79; 
DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 07
ACTI WIND WINAVI
?? CHR(7)
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
READ
RELE WIND WINAVI
RETURN
*************************
 PROCEDURE CHKPRINT
 PARAMETERS SALTAR
 store .t. to wprinting
 do while wprinting
    store "Prepare la impresora y oprima (Ù) para continuar o (R)echazar" to Qmes
    @ 23,1 
    @ 23,40-(len(Qmes)/2) say Qmes
    store " " to wstat
    @ 23,78 get wstat
    read
    if upper(wstat) = "R"
       store 1 to saltar
       store .f. to wprinting
    else
       store 0 to saltar
       if sys(13) = "READY"
          store .f. to wprinting
       endif
    endif
    @ 23,1
 enddo
 RETURN
*****************
PROCEDURE ARMACOD
STORE LEN(WCODPAC)                                    TO WLEN
STORE AT(" ",WCODPAC)                                 TO WPOS
STORE SUBSTR(WCODPAC,1,(WPOS-1))                      TO WPART1
STORE LTRIM(SUBSTR(WCODPAC,WPOS,(WLEN-WPOS)+1)) TO WPART2
STORE WPART1+"-"+WPART2                               TO WXCODPAC
RETURN
*****************
PROCEDURE ARMANOM
IF FACDCGE.TIPPAC="A"
   SELECT AFIAFI
   SET ORDER TO 1
   SEEK FACDCGE.CODPAC
   IF FOUND()
      STORE ALLTRIM(PAPELLIDO)+" "+;
            ALLTRIM(SUBSTR(SAPELLIDO,1,1))+","+;
            ALLTRIM(PNOMBRE)+" "+;
            ALLTRIM(SUBSTR(SNOMBRE,1,1))  TO WNOMBRE
      STORE HISTORIA                      TO WHISTORIA
      STORE (DATE()-NACIMIENTO)/365       TO WEDAD
      STORE DIRECCION                     TO WDIRE
   ELSE
      STORE "NO REGISTRADO"               TO WNOMBRE,WHISTORIA,WDIRE
      STORE 0                             TO WEDAD
   ENDIF
ELSE
   SELECT SYSPAC
   SEEK FACDCGE.CODPAC
   IF FOUND()
      STORE ALLTRIM(PAPELLIDO)+" "+;
            ALLTRIM(SUBSTR(SAPELLIDO,1,1))+;
            ALLTRIM(PNOMBRE)+" "+;
            ALLTRIM(SUBSTR(SNOMBRE,1,1)) TO WNOMBRE
      STORE HISTORIA                TO WHISTORIA
      STORE (DATE()-NACIMIENTO)/365 TO WEDAD
      STORE DIRECCION               TO WDIRE
   ELSE
      STORE "NO REGISTRADO" TO WNOMBRE,WHISTORIA,WDIRE
      STORE 0               TO WEDAD
   ENDIF
ENDIF
RETURN
*************************
PROCEDURE CHKACC
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO,WFILTRO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
   STORE FILTRO TO WFILTRO
ENDIF
RETURN
******************
PROCEDURE MONTOESC
******************
STORE WMONTOESC TO WNETO
STORE WMONTOESC TO WMONTO
STORE INT(WMONTO/1000000) TO MILLONES
STORE WMONTO-MILLONES*1000000 TO WMONTO
STORE INT(WMONTO/1000) TO MILES
STORE WMONTO-MILES*1000 TO WMONTO
STORE INT(WMONTO/100) TO CIENTOS
STORE WMONTO-CIENTOS*100 TO WMONTO
STORE INT(WMONTO/10) TO DECENAS
STORE WMONTO-DECENAS*10 TO WMONTO
STORE INT(WMONTO/1) TO UNIDADES
STORE WMONTO-UNIDADES*1 TO WMONTO
STORE (WNETO-INT(WNETO))*100 TO CENTIMOS
SELECT 25 
USE FACMONTO

***** MILLONES ******
GO TOP
LOCATE FOR VALOR > MILLONES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILLONES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILLONES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILLONES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILLONES = 1
   STORE RTRIM(Wescrito)+" MILLON " TO Wescrito
ELSE
   IF MILLONES > 1
      STORE RTRIM(Wescrito)+" MILLONES " TO Wescrito
   ENDIF
ENDIF
***** MILES ******
GO TOP
LOCATE FOR VALOR > MILES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS MILES APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
STORE MILES-VALOR TO RESTO
IF MILES >= 100 .AND. MILES < 200 .AND. RESTO > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LOS MILES APROPIADOS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
IF MILES > 0
   STORE RTRIM(Wescrito)+" MIL " TO Wescrito
ENDIF
***** CIENTOS ****
GO TOP
LOCATE FOR VALOR > CIENTOS*100
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LOS CIENTOS APROPIADOS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" "+DES TO Wescrito
ENDIF
IF CIENTOS = 1 .AND. DECENAS*10+UNIDADES > 0
   STORE RTRIM(Wescrito)+"TO" TO Wescrito
ENDIF
***** DECENAS ****
IF DECENAS > 1
   GO TOP
   LOCATE FOR VALOR > DECENAS*10
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE LAS DECENAS APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   IF VALOR > 0
      STORE RTRIM(Wescrito)+" "+DES TO Wescrito
   ENDIF
ELSE
   STORE DECENAS*10+UNIDADES TO UNIDADES
ENDIF
***** UNIDADES ****
GO TOP
LOCATE FOR VALOR > UNIDADES
IF .NOT. FOUND()
   STORE "ERROR, NO ENCONTRE LAS UNIDADES APROPIADAS" TO MES
   DO AVISO WITH MES
ENDIF
GO RECNO()-1
IF VALOR > 0
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
ENDIF
STOR UNIDADES-VALOR TO RESTO
STORE .T. TO CHECKREST
DO WHILE CHECKREST
   GO TOP
   IF RESTO = 0
      STORE .F. TO CHECKREST
      LOOP
   ENDIF
   LOCATE FOR VALOR > RESTO
   IF .NOT. FOUND()
      STORE "ERROR, NO ENCONTRE EL RESTO DE LAS UNIDADES APROPIADAS" TO MES
      DO AVISO WITH MES
   ENDIF
   GO RECNO()-1
   STORE RTRIM(Wescrito)+" Y "+DES TO Wescrito
   STORE RESTO-VALOR TO RESTO
ENDDO
STORE RTRIM(Wescrito)+" Bolivares con " TO Wescrito
***** CENTIMOS ****
STORE RTRIM(Wescrito)+" "+LTRIM(RTRIM(STR(CENTIMOS,5)))+"/100" TO Wescrito
SELECT 25
USE
RETURN
