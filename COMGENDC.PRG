STORE .F. TO WFLAGGEN
IF WTIPODOC = "ORD"
   STORE "COT" TO WREF
   STORE "SOLIC.DE COTIZACION" TO WREFDES
   STORE .T. TO WFLAGCLI
ELSE
   IF WTIPODOC = "REC"
      STORE "ORD" TO WREF
      STORE "ORDEN DE COMPRA" TO WREFDES
      STORE .T. TO WFLAGCLI
   ELSE
      IF WTIPODOC = "DEV"
         STORE "REC" TO WREF
         STORE "RECEP.DE COMPRA" TO WREFDES
         STORE .T. TO WFLAGCLI
      ELSE
         STORE "COT" TO WREF
         STORE "SOLIC.DE COTIZACION" TO WREFDES
         STORE .T. TO WFLAGCLI
      ENDIF
   ENDIF
ENDIF
STORE "REFERENCIA. "+WREFDES+" No.:" TO MES
DO MENSAJE WITH MES
STORE SPACE(7) TO WNUMREF
@ 23,58 GET WNUMREF
READ
IF WNUMREF<>SPACE(7)
   STORE ALLTRIM(WNUMREF)                      TO WNUMREF
   STORE REPLICATE("0",7-LEN(WNUMREF))+WNUMREF TO WNUMREF
   @ 23,58 SAY WNUMREF
ELSE
   RETURN
ENDIF

STORE WREF+WNUMREF TO WCLAVEREF
SELECT COMDCGE
FIND &WCLAVEREF
IF EOF()
   STORE WREFDES+" No."+WNUMREF+" NO EXISTE. <ENTER>" TO MES
   DO AVISO WITH MES
   RETURN
ENDIF

IF ALMACEN <> WEJCINV
   STORE "DOCUMENTO PERTENECE A OTRO ALMACEN, SELECCIONE AL ENTRAR AL MODULO" TO MES
   DO AVISO WITH MES
   RETURN
ENDIF

*** VERIFICAR LOS RENG. DE LA REF.
SELECT COMDCDE
STORE 0 TO WTOTPRO
FIND &WCLAVEREF
DO WHILE .NOT. EOF() .AND. NUMERO = WCLAVEREF
   STORE RECNO()   TO WRECDE
   STORE RENGLON   TO WREN
   STORE TIPITEM   TO WTIP
   STORE ITEM      TO WITE
   STORE CANTIDAD  TO WCAN
   STORE PRECIO    TO WPRE
   IF FILLOC()
      APPEND BLANK
      REPLACE NUMERO    WITH WNUMERO2
      REPLACE RENGLON   WITH WREN
      REPLACE TIPITEM   WITH WTIP
      REPLACE ITEM      WITH WITE
      REPLACE CANTIDAD  WITH WCAN
      REPLACE PRECIO    WITH WPRE

      REPLACE ORIGEN      WITH "COM"
      REPLACE DEPTO       WITH WUSERUBI
      REPLACE USUARIO     WITH WUSERCODE
      REPLACE USUARIOF    WITH DATE()
      FLUSH
      UNLOCK ALL
   ENDIF
   STORE WTOTPRO + 1 TO WTOTPRO
   GO WRECDE
   SKIP
ENDDO
SELECT COMDCGE
IF WTOTPRO > 0
   STORE PROVEEDOR  TO WPROVEEDOR
   STORE REFERPROVE TO WREFERPROVE
   STORE DATE()     TO WELABORADO
   STORE SUBDOC     TO WSUBDOC
   STORE PORIMP     TO WPORIMP
   STORE SUBIMP     TO WSUBIMP
   STORE MONTO      TO WMONTO
   STORE VENCE      TO WVENCE
   STORE COMENT1    TO WCOMENT1
   STORE COMENT2    TO WCOMENT2
   STORE COMENT3    TO WCOMENT3
   STORE COMENT4    TO WCOMENT4
   STORE COMENT5    TO WCOMENT5
   STORE TIPBENEFI  TO WTIPBENEFI
   STORE BENEFI     TO WBENEFICIA
   store .t. to wflaggen
   IF FILLOC()
      APPEND BLANK
      REPLACE NUMERO     WITH WNUMERO2
      REPLACE REFERENCIA WITH WCLAVEREF
      REPLACE PROVEEDOR  WITH WPROVEEDOR
      REPLACE REFERPROVE WITH WREFERPROVE
      REPLACE ELABORADO  WITH WELABORADO
      REPLACE SUBDOC     WITH WSUBDOC
      REPLACE PORIMP     WITH WPORIMP
      REPLACE SUBIMP     WITH WSUBIMP
      REPLACE MONTO      WITH WMONTO
      REPLACE VENCE      WITH WVENCE
      REPLACE ALMACEN    WITH WEJCINV
      REPLACE COMENT1    WITH WCOMENT1
      REPLACE COMENT2    WITH WCOMENT2
      REPLACE COMENT3    WITH WCOMENT3
      REPLACE COMENT4    WITH WCOMENT4
      REPLACE COMENT5    WITH WCOMENT5
      REPLACE TIPBENEFI  WITH WTIPBENEFI
      REPLACE BENEFI     WITH WBENEFICIA
      REPLACE ORIGEN      WITH "COM"
      REPLACE DEPTO       WITH WUSERUBI
      REPLACE USUARIO     WITH WUSERCODE
      REPLACE USUARIOF    WITH DATE()
      FLUSH
      UNLOCK ALL
   ENDIF
ENDIF
SELECT COMDCGE
RETURN

