
@ 10,30 CLEAR TO 12,50
@ 10,30       TO 12,50 DOUBLE
STORE DATE()  TO XFECHA
STORE SPACE(30) TO WNOMBRE
@ 11,32 SAY "Fecha: " GET XFECHA
READ

SELECT CITCIT
SET ORDER TO CITCIT4
STORE STR(YEAR(XFECHA),4)+STR(MONTH(XFECHA),2)+STR(DAY(XFECHA),2) TO WCLAVE
SEEK WCLAVE
ON KEY LABEL F4 DO BUSCAR
ON KEY LABEL F5 DO CONSOL
ON KEY LABEL F6 DO SINSOL
DEFI WIND BRCIT FROM 04,00 TO 20,79;
                TITLE " CITAS " ;
                FOOTER " F4=Buscar x medico, F5=Solicitud con cita, F6= Solicitud sin cita, Esc=Salir ";
                DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND BRCIT
BROWSE FIELDS FECHA:H="Fecha",CONSUL:H="Ub.", SYSMED.NOMBRE:H="Medico", WNOMBRE=FCODPAC():H="Paciente";
              NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW BRCIT
RELEASE WIND BRCIT
SELECT CITCIT
SET ORDER TO CITCIT1
RETURN
***********
PROC BUSCAR
***********
DEFI WIND WINBUS FROM 12,29 TO 14,51 TITLE " BUSCAR x MEDICO ";
                DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINBUS
STORE SPACE(3) TO XMEDICO
@ 0,2 SAY "Medico: " GET XMEDICO VALID VALMED()
READ
STORE RECNO() TO WRECORI
SELECT CITCIT
SET ORDER TO CITCIT4
STORE STR(YEAR(XFECHA),4)+STR(MONTH(XFECHA),2)+STR(DAY(XFECHA),2)+XMEDICO TO WCLAVE
SEEK WCLAVE
IF .NOT.FOUND()
   GO WRECORI
ENDIF
RELE WIND WINBUS
RETURN
************
FUNC FCODPAC
************
IF CITCIT.TIPPAC="A"
   SELECT AFIAFI
   SET ORDER TO AFIAFI1
   SEEK CITCIT.CODPAC
   IF FOUND()
      STORE ALLTRIM(PAPELLIDO)+" "+ALLTRIM(SAPELLIDO)+", "+ALLTRIM(PNOMBRE)+" "+ALLTRIM(SNOMBRE) TO WNOMBRE
   ENDIF
ELSE
   SELECT CITPAC
   SET ORDER TO SYSPAC
   SEEK CITCIT.CODPAC
   IF FOUND()
      STORE ALLTRIM(PAPELLIDO)+" "+ALLTRIM(SAPELLIDO)+", "+ALLTRIM(PNOMBRE)+" "+ALLTRIM(SNOMBRE) TO WNOMBRE
   ENDIF
ENDIF
RETURN WNOMBRE
***********
FUNC VALMED
***********
select SYSMED
do while .t.
   if XMEDICO<>space(3)
      seek XMEDICO
      if found()
         EXIT
      else
         store "MEDICO NO ATIENDE EL DIA PREVIAMENTE EL "+DTOC(XFECHA) TO WTEXT
         DO AVISO WITH WTEXT
         RETURN .F.
      endif
   endif
   DEFI WIND WINMED FROM 15,5 TO 23,70;
             TITLE " MEDICOS ACTIVOS " ;
             FOOTER "Esc=Seleccionar";
             DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
   ACTI WIND WINMED
   BROWSE FIELDS MEDICO:H="MEDICO", NOMBRE:H="NOMBRE", SYSESP.DESCRI:H="ESPECIALIDAD";
          NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINMED
   RELE WIND WINMED
   STORE MEDICO TO XMEDICO
enddo
return .T.
**********
