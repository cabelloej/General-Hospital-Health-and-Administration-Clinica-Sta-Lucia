PUSH KEY CLEAR
DEFI WIND WINDGE FROM 1,0 TO 19,79;
          TITLE  " "+WNOMDOC+" ";
          FOOTER " F1=Inc, F2=Mod, F3=Anu, F4=Bus, F6=Ver, F7=Fil, Esc=Salir " ;
          DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
DEFI WIND WINDTT FROM 20,0 TO 22,79;
          DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ON KEY LABEL F1 DO PROGEINC
ON KEY LABEL F2 DO PROGEMOD
ON KEY LABEL F3 DO PROGEELI
ON KEY LABEL F4 DO PROGEBUS
ON KEY LABEL F6 DO PROGEVER
ON KEY LABEL F7 DO PROGEFIL
ACTI WIND WINDGE
SELECT SERDCGE
GO BOTT
STORE SPACE(3) TO WEJEFIL
IF WTIPODOC="SOL"
   BROWSE FIELDS WNUMER=FUNNUM():H="Nro.",;
                 ELABORADO:H="Fecha",;
                 PROVEEDOR:H="Eje",; 
                 WNOMESP=FUNESP():H="Espec.",;
                 WFAC=FUNFAC():H="F",;
                 WATE=FUNATE():H="A",;
                 XNOMPAC=FUNNOM():H="Paciente                      ",;
                 WTOTAL=FUNTOT():H="Monto",;
                 ORDENADO:H="Sol",;
                 FACTURA:H="Factura",COMPROB:H="Comprobante";
          NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDGE;
          FOR FUNFIL()
ELSE
   BROWSE FIELDS WNUMER=FUNNUM():H="Nro.",WREFER=FUNREF():H="Refcia",ELABORADO:H="Fecha",;
                 WNOMESP=FUNESP():H="Espec.",;
                 WFAC=FUNFAC():H="F",WCTA=FUNCTA():H="T",;
                 XNOMPAC=FUNNOM():H="Paciente                      ",;
                 WTOTAL=FUNTOT():H="Monto",PROVEEDOR:H="Eje",ORDENADO:H="Sol";
          NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDGE;
          FOR FUNFIL()
ENDIF
DEACT WIND WINDGE
DEACT WIND WINDDE
DEACT WIND WINDTT
POP KEY
RETURN
***********
FUNC FUNNUM
***********
PUSH KEY CLEAR
STORE SUBSTR(SERDCGE.NUMERO,7,4) TO WNUMER
POP KEY
RETURN WNUMER
***********
FUNC FUNREF
***********
PUSH KEY CLEAR
STORE SUBSTR(SERDCGE.REFERENCIA,4,7) TO WREFER
POP KEY
RETURN WREFER
***********
FUNC FUNFAC
***********
PUSH KEY CLEAR
SELECT FACDCGE 
SEEK SERDCGE.NUMERO
IF FOUND()
      POP KEY
      STORE "X" TO WDOCSTAT
ELSE
   IF SERDCGE.MONTO=0
      POP KEY
      STORE "-" TO WDOCSTAT 
   ELSE
      POP KEY
      STORE " " TO WDOCSTAT
   ENDIF
ENDIF
SELECT SERDCGE
RETURN WDOCSTAT
***********
FUNC FUNCTA 
***********
PUSH KEY CLEAR
IF SERDCGE.CUENTA<>SPACE(10)
   POP KEY
   RETURN "X"
ELSE      
   RETURN " "
   POP KEY
ENDIF
RETURN
***********
FUNC FUNATE
***********
PUSH KEY CLEAR
IF SERDCGE.COMPROB<>SPACE(10)
   POP KEY
   RETURN "X" 
ELSE
   POP KEY
   RETURN " "
ENDIF
RETURN 
***********
FUNC FUNNOM
***********
PUSH KEY CLEAR
STORE SPACE(1)         TO XNOMPAC
STORE SERDCGE.TIPPAC   TO XTIPPAC
STORE SERDCGE.CODPAC   TO XCODPAC
DO BUSPACX
STORE XNOMPAC          TO XNOMPAC
SELECT SERDCGE
POP KEY
RETURN XNOMPAC
***********
FUNC FUNESP
***********
PUSH KEY CLEAR
STORE SPACE(6) TO WNOMESP
SELECT SERDCDE
SEEK SERDCGE.NUMERO
DO WHILE .NOT.EOF().AND SERDCGE.NUMERO=SERDCDE.NUMERO
   IF SERDCDE.TIPITEM="S"
      STORE SUBSTR(SERDCDE.ITEM,4,2) TO WXCODESP 
      SELECT SYSESP
      SEEK WXCODESP
      IF FOUND()
         STORE  SUBSTR(DESCRI,1,6)   TO WNOMESP
         EXIT
      ENDIF                                  
   ENDIF
   SELECT SERDCDE
   SKIP
ENDDO
SELECT SERDCGE
POP KEY
RETURN WNOMESP
***********
FUNC FUNTOT
***********
PUSH KEY CLEAR
STORE STR(SERDCGE.MONTO,10,2) TO WMONTO
POP KEY
RETURN WMONTO
***********
FUNC FUNFIL
***********
SELECT SERDCGE
*** POR AREA
*
*IF (SUBSTR(NUMERO,1,3)=WTIPODOC)
*   IF WEJEFIL=SPACE(3)
*      SELECT SERDCGE
*      RETURN .T.
*   ELSE
*     IF SERDCGE.PROVEEDOR=WEJEFIL
*         SELECT SERDCGE
*         RETURN .T.
*      ELSE
*         SELECT SERDCGE
*         RETURN .F.
*      ENDIF
*   ENDIF
*ELSE
*   SELECT SERDCGE
*   RETURN .F.
*ENDIF
*
*** POR ESPECIALIDAD
*
IF (SUBSTR(NUMERO,1,3)=WTIPODOC)
   IF WEJEFIL=SPACE(2)
      SELECT SERDCGE
      RETURN .T.
   ENDIF
   SELECT SERDCDE
   SEEK SERDCGE.NUMERO
   IF .NOT.FOUND()
       SELECT SERDCGE
       RETURN .F.
   ENDIF
   STORE SPACE(2) TO WCODEJEBD
   SELECT SERDCDE
   DO WHILE .NOT.EOF().AND.SERDCGE.NUMERO=SERDCDE.NUMERO
      IF TIPITEM="S"    
         STORE SUBSTR(ITEM,4,2) TO WCODEJEBD
         EXIT
      ENDIF
      SKIP
   ENDDO
   IF WCODEJEBD=WEJEFIL
      SELECT SERDCGE
      RETURN .T.
   ELSE
      SELECT SERDCGE
      RETURN .F.
   ENDIF
ELSE
   SELECT SERDCGE
   RETURN .F.
ENDIF

SELECT SERDCGE
RETURN
******************
PROCEDURE PROGEINC
******************
PUSH KEY CLEAR
STORE "INCLUIR"                  TO WFLAGACT
SELECT SERDCGE
SCATT MEMV BLANK
STORE WUSERCODE                  TO M.NUMERO
STORE WCODPAC                    TO M.CODPAC
STORE SUBSTR(WCODPAC,1,10)       TO WCODPAC1
STORE VAL(SUBSTR(WCODPAC,11,4))  TO WCODPAC2
*
STORE SPACE(1)                   TO WNEWNUM
STORE SPACE(1)                   TO M.NOMSOL
STORE SPACE(1)                   TO M.NOMEJE
STORE SPACE(1)                   TO M.NOMPAC
***
DO LIMDOC
STORE .T.                        TO WFLAGEDIT                     
DO GETGEN
IF WFLAGEDIT
   STORE "GUARDAR DOCUMENTO" TO WFLAGR
   STORE 1 TO WOP
   DO PROCOPC WITH WFLAGR
   IF WOP=1
      DO CREANUM
      DO CONVNUM
      DO ASIGNUM
      IF WTIPODOC="COM"
         IF M.REFERENCIA<>SPACE(10)
            DO ACTREFE
         ENDIF
         DO SERACTFA
         DO SERACTIN
      ENDIF
      *DO PROGEVER
   ELSE
      DO LIMDOC
   ENDIF
ELSE
   DO LIMDOC
ENDIF
ACTI WIND WINDGE
POP KEY
RETURN
******************
PROCEDURE PROGEMOD
******************
PUSH KEY CLEAR
STORE "MODIFICAR" TO WFLAGACT
STORE SUBSTR(SERDCGE.NUMERO,1,3) TO WTIPODOC
*
IF WTIPODOC="SOL".AND.SERDCGE.FACTURA<>SPACE(10)
   STORE "SOLICITUD YA FACTURADA CON DOCUMENTO "+SUBSTR(SERDCGE.FACTURA,4,7) TO WTEXT
   DO AVISO WITH WTEXT
   POP KEY
   RETURN
ENDIF
IF WTIPODOC="SOL".AND.SERDCGE.COMPROB<>SPACE(10)
   STORE "SOLICITUD YA PROCESADA CON DOCUMENTO "+SUBSTR(SERDCGE.COMPROB,4,7) TO WTEXT
   DO AVISO WITH WTEXT
   POP KEY
   RETURN
ENDIF
*
STORE SPACE(1)                   TO M.NOMPAC
STORE SPACE(1)                   TO M.NOMSOL
STORE SPACE(1)                   TO M.NOMEJE
SCATT MEMV
STORE SUBSTR(M.CODPAC,1,10)      TO WCODPAC1
STORE VAL(SUBSTR(M.CODPAC,11,4)) TO WCODPAC2
*
STORE .T.                        TO WFLAGEDIT   
DO GETGEN
IF WFLAGEDIT.AND.SUBSTR(SERDCGE.NUMERO,1,3)="COM"
   DO SERACTFA
   DO SERACTIN
ENDIF
ACTI WIND WINDGE
POP KEY
RETURN
******************
PROCEDURE PROGEELI
******************
PUSH KEY CLEAR
STORE SUBSTR(SERDCGE.NUMERO,1,3) TO WTIPODOC
IF WTIPODOC="SOL".AND.SERDCGE.FACTURA<>SPACE(10)   
   STORE "SOLICITUD YA FACTURADA CON DOCUMENTO "+SUBSTR(SERDCGE.FACTURA,4,7) TO WTEXT
   DO AVISO WITH WTEXT
   POP KEY
   RETURN
ENDIF
IF WTIPODOC="SOL".AND.SERDCGE.COMPROB<>SPACE(10)
   STORE "SOLICITUD YA PROCESADA CON DOCUMENTO "+SUBSTR(SERDCGE.COMPROB,4,7) TO WTEXT
   DO AVISO WITH WTEXT
   POP KEY
   RETURN
ENDIF
STORE "ANULAR" TO WFLAGACT
STORE 1 TO WOP
DO PROCOPC2 WITH WFLAGACT
IF WOP=2
   SELECT SERDCGE
   *STORE RECNO()      TO WRECNOGE
   STORE NUMERO        TO WDOCTOELI
   STORE REFERENCIA    TO WREFERCOM
   IF RECLOC()
      DELETE
      *REPLACE SUBDOC   WITH 0
      *REPLACE PORIMP   WITH 0
      *REPLACE SUBIMP   WITH 0
      *REPLACE MONTO    WITH 0
      *REPLACE USUARIO  WITH WUSERCODE
      *REPLACE USUARIOF WITH DATE()
      FLUSH
      UNLOCK ALL
      SELECT SERDCDE
      *SEEK SERDCGE.NUMERO
      SEEK WDOCTOELI
      *DO WHILE .NOT. EOF() .AND. SERDCDE.NUMERO=SERDCGE.NUMERO
      DO WHILE .NOT. EOF() .AND. SERDCDE.NUMERO=WDOCTOELI
         IF RECLOC()
            DELETE
            *REPLACE CANTIDAD WITH 0
            *REPLACE EJECUTOR WITH SPACE(8)
            FLUSH
            UNLOCK ALL
         ELSE
            DO PROCNUL
         ENDIF
         SKIP
      ENDDO
      IF WTIPODOC="COM"
         SELECT SERDCGE
         SEEK WREFERCOM
         IF FOUND()
            IF RECLOC()
               REPLACE COMPROB WITH SPACE(10)
               FLUSH
               UNLOCK ALL
            ELSE
               DO PROCNUL
            ENDIF
         ENDIF
         DO SERACTIN
         DO SERACTFA
      ENDIF
   ELSE
      DO PROCNUL
   ENDIF
ENDIF
SELECT SERDCGE
SEEK WDOCTOELI
*GO WRECNOGE
ACTI WIND WINDGE
POP KEY
RETURN
******************
PROCEDURE PROGEBUS
******************
PUSH KEY CLEAR
DEFI WIND WINDBUS FROM 12,12 TO 14,55;
          TITLE " BUSCAR ";
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDBUS
STORE 0 TO M.NUMERO
@ 00,03 SAY "NUMERO: " GET M.NUMERO PICTURE "9999999"
READ
DO CONVNUM
SEEK M.NUMERO
RELE WIND WINDBUS
ACTI WIND WINDGE
POP KEY
RETURN
******************
PROCEDURE PROGEVER
******************
PUSH KEY CLEAR
DEFI WIND WINDVER FROM 12,19 TO 14,59;
          TITLE " SALIDA ";
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDVER
DO WHILE .T.
   STORE 1 TO WOP
   @ 00,03 SAY "OPCIONES: ";
   GET WOP PICT "@*H MONITOR  ;IMPRESORA "
   READ
   IF LASTKEY()=13
      EXIT
   ENDIF
ENDDO
RELE WIND WINDVER
STORE SERDCGE.NUMERO       TO M.NUMERO
STORE SUBSTR(M.NUMERO,1,3) TO WTIPODOC
STORE WOP                  TO WSALIDA
DO SERIMPDC
POP KEY
RETURN
*************
PROC PROGEFIL
*************
PUSH KEY CLEAR
DEFI WIND WINFIL FROM 08,30 TO 10,50 TITLE "Filtro x Eje.";
     DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND WINFIL     
     
     *STORE SPACE(3) TO WEJEFIL
     *@ 0,1 SAY "Ejecutor:" GET WEJEFIL VALID VALEJE()
     *READ

     STORE SPACE(2) TO WEJEFIL
     @ 0,1 SAY "Espec.:"  GET WEJEFIL 
     *VALID VALESP()
     READ

     RELE WIND WINFIL
SELECT SERDCGE
POP KEY
RETURN
******************************* RUTINAS ***********************************
***********
PROC LIMDOC
***********
SELECT SERDCGE
DO WHILE .T.
   SEEK M.NUMERO
   IF FOUND()
      IF RECLOC()
         DELETE 
         UNLOCK ALL
      ENDIF
   ELSE
      EXIT
   ENDIF
ENDDO
SELECT SERDCDE
SET ORDER TO SERDCDE
DO WHILE .T.
   SEEK M.NUMERO
   IF FOUND()
      IF RECLOC()
         DELETE
         UNLOCK ALL
      ENDIF
   ELSE
      EXIT
   ENDIF
ENDDO
RETURN
************
PROC CREANUM
************
SELECT SERDATA
IF RECLOC()
   IF WTIPODOC="COM"
      REPLACE SERSERICOM WITH SERSERICOM+1
      STORE SERSERICOM   TO   WNEWNUM
   ELSE
      REPLACE SERSERISOL WITH SERSERISOL+1
      STORE SERSERISOL   TO   WNEWNUM
   ENDIF
   FLUSH
   UNLOCK ALL
ENDIF
RETURN
************
PROC CONVNUM
************
STORE LTRIM(STR(WNEWNUM,7))                   TO WNEWNUM
STORE REPLICATE("0",7-LEN(WNEWNUM))+WNEWNUM   TO WNEWNUM
RETURN
************
PROC ASIGNUM
************
STORE WTIPODOC+WNEWNUM TO WNEWNUM
SELECT SERDCGE
DO WHILE .T.
   SEEK M.NUMERO
   IF FOUND()
      IF RECLOC()
         REPLACE NUMERO WITH WNEWNUM 
         FLUSH
         UNLOCK ALL
      ELSE
         STORE "ACTUALIZACION RECHAZADA, FAVOR EDITAR NUEVAMENTE" TO WTEXT
         DO AVISO WITH WTEXT
      ENDIF
   ELSE
      EXIT
   ENDIF
ENDDO
SEEK WNEWNUM
IF .NOT.FOUND()
   STORE "SE PERDIO EL REGISTRO DEL DOCUMENTO: "+WNEWNUM TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
SELECT SERDCDE
DO WHILE .T.
   SEEK M.NUMERO
   IF FOUND()
      IF RECLOC()
         REPLACE NUMERO WITH WNEWNUM
         FLUSH
         UNLOCK ALL
      ELSE
         STORE "ACTUALIZACION RECHAZADA, FAVOR EDITAR NUEVAMENTE" TO WTEXT
         DO AVISO WITH WTEXT
      ENDIF
   ELSE
      EXIT
   ENDIF
ENDDO
STORE WNEWNUM TO M.NUMERO
RETURN
************
PROC ACTREFE
************
SELECT SERDCGE
SEEK M.REFERENCIA
IF FOUND()
   IF RECLOC()
      REPLACE COMPROB WITH M.NUMERO 
      FLUSH
      UNLOCK ALL
   ENDIF
ELSE
   STORE "NO SE PUDO ACTUALIZAR LA REFERENCIA" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
SEEK M.NUMERO
RETURN
***********
PROC GETGEN
***********
DEFI WIND WINDGETG FROM 2,0 TO 10,79;
          TITLE  " "+WFLAGACT+" " ;
          FOOTER " Esc=Salir";
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDGETG

@ 0,01 SAY "Numero  :"
@ 0,55 SAY "Referencia :"      

@ 2,01 SAY "Paciente:"
@ 2,55 SAY "Cta.Ing.Hos:"

@ 4,01 SAY "Solicita:"
@ 4,55 SAY "Fecha      :" 

@ 6,01 SAY "Ejecuta :"

@ 0,10 SAY M.NUMERO


*** BUSCA CUENTA EN CASO DE SER UN COMPROBANTE PARA PACIENTE HOSPITALIZADO 
*** (YA SE TIENE EL CODIGO DE PACIENTE EN MEMORIA)
IF WFLAGACT="INCLUIR"  
   SELECT ADMADM
   SET ORDER TO ADMADM2
   SEEK WCODPAC
   IF FOUND()
      IF FACTURA=SPACE(10)
         STORE CUENTA    TO M.CUENTA
         STORE WTIPPAC   TO M.TIPPAC
         STORE WCODPAC   TO M.CODPAC
      ELSE
         STORE "PACIENTE FACTURADO X INGRESOS HOSP., EFECTUE ALTA ADMINISTRATIVA"  TO MES
         DO AVISO WITH MES
         STORE .F. TO WFLAGEDIT
         RELE WIND WINDGETG
         RETURN
      ENDIF
   ELSE
      STORE SPACE(10)  TO M.CUENTA
   ENDIF
   SELECT SERDCGE
   @ 2,68 SAY M.CUENTA
ENDIF
IF WFLAGACT="INCLUIR"
   STORE 0        TO WNUMREF
   STORE SPACE(3) TO WTIPREF 
ELSE
   IF WFLAGACT="MODIFICAR"    
      DO SHOWGEN
   ENDIF
ENDIF
**
IF WFLAGACT="INCLUIR".AND.WTIPODOC="COM".AND.M.CUENTA=SPACE(10)
   *** PETICION DE REFERENCIA Y GENERACION DE DCTO CON ESTA    
   @ 0,68 GET WTIPREF    VALID VALTR()
   READ
   IF LASTKEY()=27
      STORE .F. TO WFLAGEDIT    
      RELE WIND WINDGETG
      RETURN
   ENDIF
ENDIF
IF WFLAGACT="INCLUIR"
   IF WTIPREF<>SPACE(3)
      @ 0,68 SAY WTIPREF
      @ 0,71 GET WNUMREF PICTURE "9999999" VALID VALNR()
      READ
      *IF LASTKEY()=27
      *   STORE .F. TO WFLAGEDIT    
      *   RELE WIND WINDGETG
      *   RETURN
      *ENDIF
   ELSE   
      IF WTIPODOC="COM".AND.M.CUENTA=SPACE(10).AND..NOT.SERDATA.COMSINREF
         STORE "ERROR, NO SE PUEDE EMITIR COMPROBANTE SIN REFERENCIA" TO WTEXT
         DO AVISO WITH WTEXT
         STORE .F. TO WFLAGEDIT
         RELE WIND WINDGETG
         RETURN
      ELSE
         STORE SPACE(7)        TO WNUMREF
         STORE WTIPREF+WNUMREF TO M.REFERENCIA   
         SELECT SERDCGE
         IF FILLOC() 
            APPEND BLANK
            REPLACE NUMERO     WITH M.NUMERO
            REPLACE REFERENCIA WITH M.REFERENCIA
            FLUSH
            UNLOCK ALL
         ELSE
            STORE "ACTUALIZACION RECHAZADA, FAVOR EDITAR NUEVAMENTE" TO WTEXT
            DO AVISO WITH WTEXT
            STORE .F. TO WFLAGEDIT 
            RELE WIND WINDGETG
            RETURN
         ENDIF
      ENDIF
   ENDIF
ENDIF
@ 0,68 SAY M.REFERENCIA

*** PACIENTE
STORE " "                           TO WNIVEL
STORE 0                             TO WDESC
STORE .F.                           TO WFLAGPAC
IF M.REFERENCIA=SPACE(10)   
   STORE SUBSTR(M.CODPAC,1,10)      TO WCODPAC1
   STORE VAL(SUBSTR(M.CODPAC,11,4)) TO WCODPAC2
   @ 02,10 GET M.TIPPAC VALID VALTIPPAC()         
   READ
   IF LASTKEY()=27
      STORE .F. TO WFLAGPAC    
   ELSE
      @ 02,12 GET WCODPAC1
      @ 02,22 SAY "-"
      @ 02,23 GET WCODPAC2 PICTURE "9999" VALID VALPAC()
      READ
   ENDIF
ELSE
   DO VALPAC
ENDIF
IF WFLAGPAC
   @ 2,28 SAY SUBSTR(M.NOMPAC,1,25)
ELSE
   STORE .F. TO WFLAGEDIT
   RELE WIND WINDGETG
   RETURN
ENDIF
     
*** BUSCA CUENTA EN CASO DE SER UNA SOLICITUD  
*** (NO SE TENIA EL CODIGO DE PACIENTE EN MEMORIA)
SELECT ADMADM
SET ORDER TO ADMADM2
SEEK M.CODPAC
IF FOUND()
   IF FACTURA=SPACE(10)
      STORE CUENTA    TO M.CUENTA
   ENDIF
ELSE
   STORE SPACE(10)  TO M.CUENTA
ENDIF
@ 2,68 SAY M.CUENTA

*** SOLICITA   
IF M.REFERENCIA=SPACE(10)
   IF M.ORDENADO=SPACE(3)
      STORE WUSERUBI TO M.ORDENADO
   ENDIF
   IF WTIPODOC="COM"
      @ 04,10 GET M.ORDENADO VALID BUSSOL() 
      READ
      IF LASTKEY()=27.AND.M.ORDENADO<>SYSPTO.CODPTO
         STORE .F. TO WFLAGEDIT    
         RELE WIND WINDGETG
         RETURN
      ENDIF
   ELSE
      DO BUSSOL
   ENDIF
   @ 04,14 SAY M.NOMSOL 
ENDIF

*** EJECUTA   
IF M.REFERENCIA=SPACE(10) 
   IF M.PROVEEDOR=SPACE(3)
      STORE WUSERUBI TO M.PROVEEDOR
   ENDIF
   @ 06,10 GET M.PROVEEDOR VALID BUSEJE()
   READ
   IF LASTKEY()=27.AND.M.PROVEEDOR<>SYSPTO.CODPTO
      STORE .F. TO WFLAGEDIT    
      RELE WIND WINDGETG
      RETURN
   ENDIF
   @ 06,14 SAY M.NOMEJE  
ENDIF

*** ELABORACION
IF WFLAGACT="INCLUIR"
   STORE DATE() TO M.ELABORADO 
   *@ 4,68 GET M.ELABORADO 
   *READ
ENDIF
@ 4,68 SAY M.ELABORADO
IF LASTKEY()=27
   STORE .F. TO WFLAGEDIT
   RELE WIND WINDGETG
   RETURN
ENDIF

IF WFLAGEDIT
   *** ACTUALIZA
   SELECT SERDCGE
   IF RECLOC()
      REPLACE ORDENADO  WITH M.ORDENADO
      REPLACE PROVEEDOR WITH M.PROVEEDOR
      REPLACE ELABORADO WITH M.ELABORADO 
      REPLACE TIPPAC    WITH M.TIPPAC
      REPLACE CODPAC    WITH M.CODPAC
      REPLACE CUENTA    WITH M.CUENTA
      *** USO INTERNO
      REPLACE ORIGEN    WITH "SER"
      REPLACE DEPTO     WITH WUSERUBI
      REPLACE USUARIO   WITH WUSERCODE
      REPLACE USUARIOF  WITH DATE()
      FLUSH
      UNLOCK ALL
   ELSE
      STORE "ACTUALIZACION RECHAZADA, FAVOR EDITAR NUEVAMENTE" TO WTEXT
      DO AVISO WITH WTEXT
   ENDIF
   ***
   DO GETGENR
   DO TOTGENR
ENDIF
RELE WIND WINDGETG
SELECT SERDCGE
RETURN
************
FUNC SHOWGEN
************
DO BUSSOL
DO BUSEJE
DO BUSPAC
@ 0,68 SAY M.REFERENCIA
@ 2,10 SAY M.TIPPAC
@ 2,12 SAY M.CODPAC
@ 2,28 SAY SUBSTR(M.NOMPAC,1,25)
@ 2,68 SAY M.CUENTA
@ 4,10 SAY M.ORDENADO
@ 4,14 SAY M.NOMSOL      
@ 4,68 SAY M.ELABORADO   
@ 6,10 SAY M.PROVEEDOR
@ 6,14 SAY M.NOMEJE
RETURN
**********
FUNC VALTR
**********
DO WHILE .T.
   IF WTIPREF<>"SOL"
      defi wind wintip  from 01,50 to 04,66 in wind windgetg
      acti wind wintip
      @ 00,00 clear
      STORE 1 to wvalop
      do while .t.
         @ 00,01 get wvalop pict "@*V Ninguna     ;Solicitud   "
         read
         if lastkey()=13
            exit
         endif
      enddo
      if wvalop=1
         store SPACE(3)   to WTIPREF
      else
         if wvalop=2
            store "SOL"   to WTIPREF
         endif
      endif
      rele wind wintip
   ENDIF
   EXIT
ENDDO
return
**********
FUNC VALNR
**********
IF WNUMREF=0
   DO SERWINSO
   STORE VAL(SUBSTR(SERDCGE.NUMERO,4,7))      TO WNUMREF
ENDIF
STORE LTRIM(STR(WNUMREF,7))                   TO WNUMREF
STORE REPLICATE("0",7-LEN(WNUMREF))+WNUMREF   TO WNUMREF
STORE WTIPREF+WNUMREF                         TO M.REFERENCIA
STORE 0                                       TO WNUMREF    
*** INTENTA GENERAR DOCUMENTO POR REFERENCIA
STORE M.NUMERO                                TO WNUMEROREF       
STORE M.REFERENCIA                            TO WCLAVEREF
DO SERGENDC
IF M.REFERENCIA<>SPACE(10)
   STORE "MODIFICAR"                          TO WFLAGACT
   DO SHOWGEN
   RETURN .T.
ELSE
   RETURN .F.
ENDIF
RETURN
***********
FUNC BUSSOL
***********
SELECT SYSPTO
DO WHILE .T.
   SEEK M.ORDENADO
   IF .NOT. FOUND()
      librpto=5
      cibrpto=0
      DO SERWINPT
      STORE CODPTO TO M.ORDENADO   
      LOOP
   ELSE
      STORE DESCRI TO M.NOMSOL
      EXIT
   ENDIF
ENDDO
RETURN
***********
FUNC BUSEJE
***********
SELECT SYSPTO
DO WHILE .T.
   SEEK M.PROVEEDOR
   IF .NOT. FOUND()
      librpto=5
      cibrpto=0
      DO SERWINPT
      STORE CODPTO TO M.PROVEEDOR
      LOOP
   ELSE
      STORE DESCRI TO M.NOMEJE
      EXIT
   ENDIF
ENDDO
RETURN
***********
FUNC VALEJE
***********
IF WEJEFIL=SPACE(3)
   RETURN .T.
ELSE
  SELECT SYSPTO
  DO WHILE .T.
     SEEK WEJEFIL
     IF .NOT. FOUND()
        librpto=5
        cibrpto=0
        DO SERWINPT
        STORE CODPTO TO WEJEFIL
        LOOP
     ELSE
        EXIT
     ENDIF
  ENDDO
ENDIF
RETURN
**************
FUNC VALTIPPAC
**************
DO WHILE .T.
   IF M.TIPPAC<>"A".AND.M.TIPPAC<>"N"
      defi wind wintip  from 03,10 to 06,28 IN WIND WINDGETG
      acti wind wintip
      STORE 1 to wvalop
      do while .t.
         @ 00,00 get wvalop pict "@*V No Afiliado ;Afiliado    "
         read
         if lastkey()=13
            exit
         endif
      enddo
      if wvalop=2
         store "A"      to M.TIPPAC
      else
         if wvalop=1
            store "N"   to M.TIPPAC
         endif
      endif
      rele wind wintip
   ENDIF
   EXIT
ENDDO
return .t.
****************
PROCEDURE VALPAC
****************
STORE WCODPAC1+STR(WCODPAC2,4) TO M.CODPAC 
IF M.TIPPAC="A"
   SELECT AFIAFI
   SET ORDER TO AFIAFI1
   SEEK M.CODPAC
   IF .NOT. FOUND()
      STORE "PACIENTE NO AFILIADO, VERIFIQUE" TO WTEXT
      DO AVISO WITH WTEXT
      STORE .F. TO WFLAGPAC
   ELSE
      STORE CEDTITU+CARGA                            TO M.CODPAC
      STORE SUBSTR(M.CODPAC,1,10)                    TO WCODPAC1
      STORE VAL(SUBSTR(M.CODPAC,11,4))               TO WCODPAC2
      STORE NIVEL                                    TO WNIVEL
      STORE DESCUENTO                                TO WDESC
      STORE ALLTRIM(AFIAFI.PAPELLIDO)+", "+ALLTRIM(AFIAFI.PNOMBRE) TO M.NOMPAC
      STORE .T.                                      TO WFLAGPAC
   ENDIF
ELSE
   SELECT SYSPAC
   SEEK M.CODPAC
   IF .NOT. FOUND()
      librPAC=5
      cibrPAC=0
      do sys0103
   ENDIF
   STORE SYSPAC.CODPAC                            TO M.CODPAC
   STORE SUBSTR(M.CODPAC,1,10)                    TO WCODPAC1
   STORE VAL(SUBSTR(M.CODPAC,11,4))               TO WCODPAC2
   STORE SYSPAC.NIVEL                             TO WNIVEL
   STORE SYSPAC.DESCUENTO                         TO WDESC
   STORE ALLTRIM(SYSPAC.PAPELLIDO)+", "+ALLTRIM(SYSPAC.PNOMBRE) TO M.NOMPAC
   STORE .T.                                      TO WFLAGPAC
ENDIF
RETURN WFLAGPAC
****************
PROCEDURE BUSPAC
****************
IF M.TIPPAC="A"
   SELECT AFIAFI
   SET ORDER TO AFIAFI1
   SEEK M.CODPAC
   IF .NOT. FOUND()
      STORE "" TO M.NOMPAC
   ELSE
      STORE ALLTRIM(AFIAFI.PAPELLIDO)+", "+ALLTRIM(AFIAFI.PNOMBRE) TO M.NOMPAC
      STORE .T. TO WFLAGPAC
   ENDIF
ELSE
   SELECT SYSPAC
   SEEK M.CODPAC
   IF .NOT. FOUND()
      STORE "" TO M.NOMPAC    
   ELSE
      STORE ALLTRIM(SYSPAC.PAPELLIDO)+", "+ALLTRIM(SYSPAC.PNOMBRE) TO M.NOMPAC
      STORE .T. TO WFLAGPAC
   ENDIF
ENDIF
SELECT SERDCGE
RETURN 
*****************
PROCEDURE BUSPACX
*****************
IF XTIPPAC="A"
   SELECT AFIAFI
   SET ORDER TO AFIAFI1
   SEEK XCODPAC
   IF .NOT. FOUND()
      STORE "" TO XNOMPAC
   ELSE
      STORE ALLTRIM(AFIAFI.PAPELLIDO)+", "+ALLTRIM(AFIAFI.PNOMBRE) TO XNOMPAC
      STORE .T. TO WFLAGPAC
   ENDIF
ELSE
   SELECT SYSPAC
   SEEK XCODPAC
   IF .NOT. FOUND()
      STORE "" TO XNOMPAC    
   ELSE
      STORE ALLTRIM(SYSPAC.PAPELLIDO)+", "+ALLTRIM(SYSPAC.PNOMBRE) TO XNOMPAC
      STORE .T. TO WFLAGPAC
   ENDIF
ENDIF
SELECT SERDCGE
RETURN 
************
PROC TOTGENR
************
STORE 0 TO WSUBDOC
SELECT SERDCDE
SEEK SERDCGE.NUMERO
DO WHILE .NOT.EOF().AND.NUMERO=SERDCGE.NUMERO
   STORE FUNTOTSH() TO WTOTRENG
   STORE WSUBDOC+WTOTRENG TO WSUBDOC
   SKIP
ENDDO
STORE WSUBDOC*(WPORIMP/100)                       TO WSUBIMP
STORE WSUBDOC+WSUBIMP                             TO WMONTO
SELECT SERDCGE
IF RECLOC()
   REPLACE SUBDOC     WITH WSUBDOC
   REPLACE PORIMP     WITH WPORIMP
   REPLACE SUBIMP     WITH WSUBIMP
   REPLACE MONTO      WITH WMONTO
   FLUSH
   UNLOCK ALL
ELSE
   STORE "ACTUALIZACION RECHAZADA, FAVOR EDITAR NUEVAMENTE" TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
RETURN

******************************************************************************
*************************    R E N G L O N E S    ****************************
******************************************************************************
*************
PROC  GETGENR
*************
PUSH KEY CLEAR
DEFI WIND WINDDE FROM 10,0 TO 19,79;
          TITLE " BIENES y SERVICIOS " ;
          FOOTER " F1=Inc, F2=Mod, F3=Eli, Esc=Salir " ;
          DOUBLE NOFLOAT NOZOOM NOGROW COLOR SCHEME 10
ACTI WIND WINDDE
ON KEY LABEL F1 DO PRORENI
ON KEY LABEL F2 DO PRORENM
ON KEY LABEL F3 DO PRORENE
ON KEY LABEL F5 DO PRORENP
STORE SERDCGE.NUMERO TO WNUMGEN
SELECT SERDCDE
DO FUNBRREN
RELE WIND WINDDE
DEACT WIND WINDTT
POP KEY
RETURN
*************
FUNC FUNBRREN
*************
BROWSE FIELDS WITEMDES=FUNCITEM():H="Descripcion",SERDCDE.CANTIDAD:P="999.99",;
              SERDCDE.PRECIO:P="9999,999.99",SERDCDE.DESCUENTO:P="999.99":H="Dscto.",;
              WTOTRENG=FUNTOTSH():H="Total renglon":P="9999,999.99",WEJEDES=FUNEJEDE():H="Autor";
       NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDDE;
       WHEN FUNSHTOT();
       KEY SERDCGE.NUMERO
RETURN
*************
FUNC FUNSHTOT
*************
ACTI WIND WINDTT
@ 0,55 SAY "SUBTOTAL :"
@ 0,65 SAY SERDCGE.MONTO PICTURE "999,999,999.99"
SELECT SERDCDE
ACTI WIND WINDDE
RETURN
************
PROC PRORENI
************
IF M.REFERENCIA=SPACE(10)
   PUSH KEY CLEAR       
   STORE "INCLUIR"      TO WFLAGR
   SELECT SERDCDE
   SCATT MEMV BLANK
   STORE WNUMGEN        TO M.NUMERO
   STORE "S"            TO M.TIPITEM
   STORE 1              TO M.CANTIDAD 
   STORE WDESC          TO M.DESCUENTO
   DO GETREN
   DO TOTGENR
   POP KEY
ENDIF
SELECT SERDCDE
RETURN
************
PROC PRORENM
************
PUSH KEY CLEAR
STORE "MODIFICAR" TO WFLAGR
SELECT SERDCDE
SCATT MEMV
DO GETREN
DO TOTGENR
POP KEY
SELECT SERDCDE
RETURN
************
PROC PRORENE
************
IF M.REFERENCIA=SPACE(10)
   PUSH KEY CLEAR
   STORE "ELIMINAR" TO WFLAGR
   STORE 2 TO WOP
   DO PROCOPC WITH WFLAGR
   IF WOP=1
      SELECT SERDCDE
      IF RECLOC()
         DELETE
         UNLOCK
         DO TOTGENR
      ELSE
         DO PROCNUL
      ENDIF
   ENDIF
   POP KEY
ENDIF
SELECT SERDCDE
RETURN
************
PROC PRORENP
************
PUSH KEY CLEAR
STORE "ACT. PRECIO RENGLON" TO WFLAGACT
STORE 1 TO WOP
DO PROCOPC WITH WFLAGACT
IF WOP=1
   SELECT SERDCDE
   IF SERDCDE.TIPITEM="B"
      SELECT ALMART
      SEEK SERDCDE.ITEM
   ELSE
      SELECT SYSSERVI
      SEEK ALLTRIM(SERDCDE.ITEM)
   ENDIF
   IF FOUND()
      STORE  PRECIO TO WPRECIO
   ELSE
      STORE "ITEM: "+SERDCDE.ITEM+" NO REGISTRADO" TO WTEXT
      DO AVISO WITH WTEXT
      STORE 0       TO WPRECIO
   ENDIF
   SELECT SERDCDE
   IF WPRECIO>0
      IF RECLOC()
         REPLACE PRECIO WITH WPRECIO
         FLUSH
         UNLOCK ALL
      ELSE
         DO PROCNUL
      ENDIF
   ENDIF
   DO TOTGENR
ENDIF
POP KEY
SELECT SERDCDE
RETURN
***********
PROC GETREN
***********
DEFI WIND WINDGETR FROM 11,0 TO 22,79;
          TITLE  WFLAGR ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDGETR
@ 0,1 SAY "Tipo (B/S) :" 
@ 1,1 SAY "Codigo     :" 
@ 2,1 SAY "Descripcion:"
@ 3,1 SAY "Cantidad   :"
@ 4,1 SAY "Precio     :" 
@ 5,1 SAY "Descuento  :"
@ 6,1 SAY "Total      :"
@ 7,1 say "Autor serv.:"
IF WFLAGR="INCLUIR"
   @ 00,14 GET M.TIPITEM          VALID VALTIP()  
   READ
   IF LASTKEY()=27
      DEACT WIND WINDGETR
      RETURN
   ENDIF
   @ 01,14 GET M.ITEM             VALID VALITE()  
   READ
ELSE
   @ 00,14 SAY M.TIPITEM      
   @ 01,14 SAY M.ITEM         
   DO VALITE        
ENDIF
IF M.REFERENCIA=SPACE(10)
   @ 03,17 GET M.CANTIDAD         PICTURE "999,999.99"  RANGE 0.01,999999.99
   READ
   IF M.PRECIO > 0
      @ 04,14  SAY M.PRECIO       PICTURE "99,999,999.99"
   ELSE
      @ 04,14 GET M.PRECIO        PICTURE "99,999,999.99" 
      READ
   ENDIF
   @ 05,21 GET M.DESCUENTO        PICTURE "999.99" RANGE 0,100
   READ
   STORE FUNTOTRE() TO WTOTREN
   @ 06,14 SAY WTOTREN            PICTURE "99,999,999.99"  
   IF LASTKEY()=27
      DEACT WIND WINDGETR
      RETURN
   ENDIF
   IF M.TIPITEM="S".AND.SYSSERVI.HONORARIO="S"
      IF WFLAGMED
         STORE WUSERCODE          TO M.EJECUTOR
      ENDIF
      @ 07,14 GET M.EJECUTOR      VALID VALAUTOR() 
      READ
      IF M.EJECUTOR=SPACE(8)
         DEACT WIND WINDGETR
         RETURN
      ENDIF
   ELSE
      STORE SPACE(8)               TO M.EJECUTOR
   ENDIF
ELSE
   @ 03,17 SAY M.CANTIDAD         PICTURE "999,999.99" 
   @ 04,14 SAY M.PRECIO           PICTURE "99,999,999.99" 
   @ 05,21 SAY M.DESCUENTO        PICTURE "999.99" 
   WTOTREN=FUNTOTRE()
   @ 06,14 SAY WTOTREN            PICTURE "99,999,999.99"  
   IF WTIPODOC="COM"
      IF M.TIPITEM="S".AND.SYSSERVI.HONORARIO="S"
         IF M.EJECUTOR=SPACE(8).AND.WFLAGMED
            STORE WUSERCODE          TO M.EJECUTOR
         ENDIF
         @ 07,14 GET M.EJECUTOR      VALID VALAUTOR() 
         READ
         IF M.EJECUTOR=SPACE(8)
            DEACT WIND WINDGETR
            RETURN
         ENDIF
      ELSE
         STORE SPACE(8)               TO M.EJECUTOR
      ENDIF
   ENDIF
ENDIF
STORE FUNTOTRE() TO WTOTREN
@ 6,14 SAY WTOTREN             PICTURE "99,999,999.99"

*IF WFLAGR="INCLUIR"
*   STORE 1 TO WOP
*ELSE
*   STORE 1 TO WOP
*   DO PROCOPC WITH WFLAGR
*ENDIF
STORE 1 TO WOP

IF WOP=1
   STORE "SER"      TO M.ORIGEN
   STORE WUSERCODE  TO M.USUARIO
   STORE WUSERUBI   TO M.DEPTO
   STORE DATE()     TO M.USUARIOF
   SELECT SERDCDE
   IF WFLAGR="INCLUIR"
      IF FILLOC()
         APPEND BLANK
         GATH MEMV
         FLUSH
         UNLOCK ALL
      ELSE
        DO PROCNUL
      ENDIF
   ELSE
      IF RECLOC()
         GATH MEMV
         FLUSH
         UNLOCK ALL
      ELSE
         DO PROCNUL
      ENDIF
   ENDIF
ENDIF
RELE WIND WINDGETR
SELECT SERDCDE
RETURN
*************
FUNC FUNCITEM
*************
IF SERDCDE.TIPITEM="B"
   SELECT ALMART
   SEEK SERDCDE.ITEM
   IF FOUND()
      STORE  SUBSTR(DESCRI,1,30)                TO WDESITEM
   ELSE
      STORE  "NO REG. EN ALMACEN"+SPACE(12)     TO WDESITEM
   ENDIF
ELSE
   IF SERDCDE.TIPITEM="S"
      SELECT SYSSERVI
      SEEK ALLTRIM(SERDCDE.ITEM)
      IF FOUND()
         STORE  SUBSTR(DESCRI,1,30)              TO WDESITEM
      ELSE                                   
         STORE  "NO REG. EN SERVICIOS"+SPACE(10) TO WDESITEM
      ENDIF
   ELSE
      STORE "TIPO DE ITEM NO DEFINIDO      "     TO WDESITEM
   ENDIF
ENDIF
SELECT SERDCDE
RETURN WDESITEM
***********
FUNC VALTIP
***********
IF M.TIPITEM="B".OR.M.TIPITEM="S"
   RETURN .T.
ELSE
   RETURN .F.
ENDIF
***********
FUNC VALITE
***********
IF M.TIPITEM="B"
   DO WHILE .T.
      IF LEN(ALLTRIM(M.ITEM))<>0
         SELECT ALMART
         SEEK M.ITEM
         IF .NOT.FOUND()
           PUSH KEY CLEAR
           DO MEDCONVA
           STORE CODIGO TO M.ITEM
           POP KEY
         ELSE
            @ 2,14 SAY DESCRI
            IF WFLAGR="INCLUIR"
               STORE CODIGO             TO M.ITEM
               IF WNIVEL=SPACE(1)
                  STORE PRECIOA         TO M.PRECIO
               ELSE
                  STORE "PRECIO"+WNIVEL TO WPRECIO
                  STORE &WPRECIO        TO M.PRECIO
               ENDIF
            ENDIF
            EXIT
         ENDIF
      ELSE
         PUSH KEY CLEAR
         DO MEDCONVA
         STORE CODIGO TO M.ITEM
         POP KEY
      ENDIF
   ENDDO
   SELECT SERDCDE
   RETURN .T.
ELSE
   DO WHILE .T.
      IF LEN(ALLTRIM(M.ITEM))<>0
         SELECT SYSSERVI
         SEEK ALLTRIM(M.ITEM)
         IF .NOT.FOUND()
            DO PROWINSE
         ELSE
            @ 2,14 SAY DESCRI
            IF WFLAGR="INCLUIR"
               STORE SYSSERVI.SERVICIO  TO M.ITEM
               IF WNIVEL=SPACE(1)
                  STORE PRECIOA         TO M.PRECIO
               ELSE
                  STORE "PRECIO"+WNIVEL TO WPRECIO
                  STORE &WPRECIO        TO M.PRECIO
               ENDIF
            ENDIF
            EXIT
         ENDIF
      ELSE
         DO PROWINSE
      ENDIF
   ENDDO
   SELECT SERDCDE
   RETURN .T.
ENDIF
RETURN
*************
PROC PROWINSE
*************   
PUSH KEY CLEAR
STORE 05 TO LIBRSER
STORE 00 TO CIBRSER
DO SERWINSE
POP KEY
IF (LEN(ALLTRIM(SYSSERVI.SERVICIO))<>12)    
   STORE SPACE(12)          TO M.ITEM
   STORE "Su seleccion es un titulo, reintente." TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
IF (SYSSERVI.PUNTO<>SPACE(3).AND.SYSSERVI.PUNTO<>M.PROVEEDOR)
   STORE SPACE(12)          TO M.ITEM
   STORE "Su Seleccion no corresponde al area ejecutora, reintente." TO WTEXT
   DO AVISO WITH WTEXT
ENDIF
STORE SYSSERVI.SERVICIO  TO M.ITEM
RETURN
*************
FUNC VALAUTOR
*************
SELECT SYSMED
SET ORDER TO SYSMED3
DO WHILE .T.
   GO TOP
   LOCATE FOR USERCODE=M.EJECUTOR
   IF .NOT. FOUND() .OR. M.EJECUTOR=SPACE(8)
      librmed=5
      cibrmed=0
      DO SERWINME
      STORE USERCODE TO M.EJECUTOR
      LOOP
   ELSE
      @ 07, 25 SAY NOMBRE 
      SET ORDER TO SYSMED1
      EXIT
   ENDIF
ENDDO
IF SYSMED.AREA<>SPACE(3).AND.SYSMED.AREA<>M.PROVEEDOR
   STORE "Esta persona labora en el area "+sysmed.area+". Intente con otro" to wtext
   DO AVISO WITH WTEXT
   RETURN .F.
ENDIF
RETURN .T.
*************
FUNC FUNEJEDE
*************
IF SERDCDE.TIPITEM="S".AND.SYSSERVI.HONORARIO="S"
   IF SERDCDE.EJECUTOR=SPACE(8)
      STORE SPACE(8)            TO WEJEDES
   ELSE
      SELECT SYSMED
      SET ORDER TO SYSMED3
      GO TOP
      LOCATE FOR USERCODE=SERDCDE.EJECUTOR
      IF .NOT. FOUND() 
         STORE "? ? ? ? "       TO WEJEDES
         LOOP
      ELSE
         STORE SERDCDE.EJECUTOR TO WEJEDES
      ENDIF
   ENDIF
ELSE
   STORE "........"             TO WEJEDES
ENDIF
SELECT SERDCDE
RETURN WEJEDES
************
PROC PROCOPC
************
PARA WTITLE
DEFI WIND WINDCON FROM 12,19 TO 14,59;
          TITLE WTITLE;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDCON
DO WHILE .T.
   @ 00,03 SAY "OPCIONES: ";
   GET WOP PICT "@*H ACEPTAR  ;CANCELAR "
   READ
   IF LASTKEY()=13
      EXIT
   ENDIF
ENDDO
RELE WIND WINDCON
RETURN
*************
PROC PROCOPC2
*************
PARA WTITLE
DEFI WIND WINDCON FROM 12,19 TO 14,59;
          TITLE WTITLE;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTIVATE WIND WINDCON
DO WHILE .T.
   @ 00,03 SAY "OPCIONES: ";
   GET WOP PICT "@*H CANCELAR ;ACEPTAR  "
   READ
   IF LASTKEY()=13
      EXIT
   ENDIF
ENDDO
RELE WIND WINDCON
RETURN
************
PROC PROCNUL
************
STORE "OPERACION RECHAZADA, FAVOR REINTENTAR." TO WTEXT
DO AVISO WITH WTEXT
RETURN
*************
FUNC FUNTOTRE
*************
STORE M.CANTIDAD*(M.PRECIO-(M.PRECIO*M.DESCUENTO/100)) TO WTOTRENG
RETURN WTOTRENG
*************
FUNC FUNTOTSH
*************
STORE CANTIDAD*(PRECIO-(PRECIO*DESCUENTO/100)) TO WTOTRENG
RETURN WTOTRENG



